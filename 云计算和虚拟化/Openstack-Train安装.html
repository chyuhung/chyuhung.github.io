<!DOCTYPE html>
<html lang="zh"><head><title>Openstack-Train安装</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="Openstack-Train安装"/><meta property="og:description" content="基础环境准备 节点规划 名称描述管理IP（虚拟机）内部IP配置ctl01控制节点10.191.101.128/24192.168.80.128/242C2Gcompute01计算节点10.191.101.129/24192.168.80.129/242C4Gneutron01网络节点10.191.101."/><meta property="og:image" content="https://chyuhung.github.io/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="基础环境准备 节点规划 名称描述管理IP（虚拟机）内部IP配置ctl01控制节点10.191.101.128/24192.168.80.128/242C2Gcompute01计算节点10.191.101.129/24192.168.80.129/242C4Gneutron01网络节点10.191.101."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="云计算和虚拟化/Openstack-Train安装"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="..">🪴 十二万光年</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>搜索</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="搜索些什么" placeholder="搜索些什么"/><div id="search-layout" data-preview="true"></div></div></div></div><div class="darkmode"><input class="toggle" id="darkmode-toggle" type="checkbox" tabindex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve"><title>暗色模式</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve"><title>亮色模式</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;云计算和虚拟化&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;基础技能&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;安全和权限管理&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;应用部署和容灾&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;故障排除和性能优化&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;文档和沟通能力&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;监控和日志管理&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;网络和存储管理&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;自动化和编程&quot;,&quot;collapsed&quot;:true}]"><h1>探索</h1><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-outer "><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="云计算和虚拟化"><button class="folder-button"><span class="folder-title">云计算和虚拟化</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="云计算和虚拟化"><li><a href="../云计算和虚拟化/docker" data-for="云计算和虚拟化/docker">docker</a></li><li><a href="../云计算和虚拟化/k8s" data-for="云计算和虚拟化/k8s">k8s</a></li><li><a href="../云计算和虚拟化/openstack" data-for="云计算和虚拟化/openstack">openstack</a></li><li><a href="../云计算和虚拟化/Openstack-Train安装" data-for="云计算和虚拟化/Openstack-Train安装">Openstack-Train安装</a></li><li><a href="../云计算和虚拟化/云计算和虚拟化" data-for="云计算和虚拟化/云计算和虚拟化">云计算和虚拟化</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="基础技能"><button class="folder-button"><span class="folder-title">基础技能</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="基础技能"><li><a href="../基础技能/go" data-for="基础技能/go">go</a></li><li><a href="../基础技能/python" data-for="基础技能/python">python</a></li><li><a href="../基础技能/shell" data-for="基础技能/shell">shell</a></li><li><a href="../基础技能/shell下载命令" data-for="基础技能/shell下载命令">shell下载命令</a></li><li><a href="../基础技能/vue" data-for="基础技能/vue">vue</a></li><li><a href="../基础技能/基础技能" data-for="基础技能/基础技能">基础技能</a></li><li><a href="../基础技能/服务器raid配置" data-for="基础技能/服务器raid配置">服务器raid配置</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="安全和权限管理"><button class="folder-button"><span class="folder-title">安全和权限管理</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="安全和权限管理"><li><a href="../安全和权限管理/ssh免密登录" data-for="安全和权限管理/ssh免密登录">ssh免密登录</a></li><li><a href="../安全和权限管理/公钥与私钥" data-for="安全和权限管理/公钥与私钥">公钥与私钥</a></li><li><a href="../安全和权限管理/安全和权限管理" data-for="安全和权限管理/安全和权限管理">安全和权限管理</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="应用部署和容灾"><button class="folder-button"><span class="folder-title">应用部署和容灾</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="应用部署和容灾"><li><a href="../应用部署和容灾/应用部署和容灾" data-for="应用部署和容灾/应用部署和容灾">应用部署和容灾</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="故障排除和性能优化"><button class="folder-button"><span class="folder-title">故障排除和性能优化</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="故障排除和性能优化"><li><a href="../故障排除和性能优化/linux-出错-task-xxxxx-634-blocked-for-more-than-120-seconds" data-for="故障排除和性能优化/linux-出错-task-xxxxx-634-blocked-for-more-than-120-seconds">linux 出错 task xxxxx 634 blocked for more than 120 seconds</a></li><li><a href="../故障排除和性能优化/mysql" data-for="故障排除和性能优化/mysql">mysql</a></li><li><a href="../故障排除和性能优化/NTP服务配置" data-for="故障排除和性能优化/NTP服务配置">NTP服务配置</a></li><li><a href="../故障排除和性能优化/故障排除和性能优化" data-for="故障排除和性能优化/故障排除和性能优化">故障排除和性能优化</a></li><li><a href="../故障排除和性能优化/鸿蒙OS系统优化" data-for="故障排除和性能优化/鸿蒙OS系统优化">鸿蒙OS系统优化</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="文档和沟通能力"><button class="folder-button"><span class="folder-title">文档和沟通能力</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="文档和沟通能力"><li><a href="../文档和沟通能力/文档和沟通能力" data-for="文档和沟通能力/文档和沟通能力">文档和沟通能力</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="监控和日志管理"><button class="folder-button"><span class="folder-title">监控和日志管理</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="监控和日志管理"><li><a href="../监控和日志管理/监控和日志管理" data-for="监控和日志管理/监控和日志管理">监控和日志管理</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="网络和存储管理"><button class="folder-button"><span class="folder-title">网络和存储管理</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="网络和存储管理"><li><a href="../网络和存储管理/ceph" data-for="网络和存储管理/ceph">ceph</a></li><li><a href="../网络和存储管理/keepalived" data-for="网络和存储管理/keepalived">keepalived</a></li><li><a href="../网络和存储管理/mysql" data-for="网络和存储管理/mysql">mysql</a></li><li><a href="../网络和存储管理/pgsql" data-for="网络和存储管理/pgsql">pgsql</a></li><li><a href="../网络和存储管理/网络和存储管理" data-for="网络和存储管理/网络和存储管理">网络和存储管理</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="自动化和编程"><button class="folder-button"><span class="folder-title">自动化和编程</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="自动化和编程"><li><a href="../自动化和编程/ansible" data-for="自动化和编程/ansible">ansible</a></li><li><a href="../自动化和编程/git" data-for="自动化和编程/git">git</a></li><li><a href="../自动化和编程/github-actions" data-for="自动化和编程/github-actions">github actions</a></li><li><a href="../自动化和编程/Jinja2" data-for="自动化和编程/Jinja2">jinja2</a></li><li><a href="../自动化和编程/自动化和编程" data-for="自动化和编程/自动化和编程">自动化和编程</a></li></ul></div></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../云计算和虚拟化/">云计算和虚拟化</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Openstack-Train安装</a></div></nav><h1 class="article-title">Openstack-Train安装</h1><p class="content-meta">2024年5月27日, 55分钟阅读</p><ul class="tags"><li><a href="../tags/云计算和虚拟化" class="internal tag-link">#云计算和虚拟化</a></li></ul></div></div><article class="popover-hint"><h2 id="基础环境准备"><strong>基础环境准备</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#基础环境准备" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="节点规划"><strong>节点规划</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#节点规划" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>















































<div class="table-container"><table><thead><tr><th>名称</th><th>描述</th><th>管理IP</th><th>（虚拟机）内部IP</th><th>配置</th></tr></thead><tbody><tr><td>ctl01</td><td>控制节点</td><td>10.191.101.128/24</td><td>192.168.80.128/24</td><td>2C2G</td></tr><tr><td>compute01</td><td>计算节点</td><td>10.191.101.129/24</td><td>192.168.80.129/24</td><td>2C4G</td></tr><tr><td>neutron01</td><td>网络节点</td><td>10.191.101.130/24</td><td>192.168.80.130/24</td><td>2C2G</td></tr><tr><td>cinder01</td><td>存储节点</td><td>10.191.101.131/24</td><td>192.168.80.131/24</td><td>2C2G</td></tr><tr><td>(新增)compute02</td><td>计算节点(win)</td><td>-</td><td>192.168.80.139/24</td><td>2C2G</td></tr></tbody></table></div>
<h3 id="系统版本"><strong>系统版本</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#系统版本" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>CentOS Linux release 7.6.1810 (Core)</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/redhat-release</span></span></code></pre></figure>
<h3 id="自动补全"><strong>自动补全</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#自动补全" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="shell" data-theme="github-light github-dark"><code data-language="shell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install bash-completion</span></span></code></pre></figure>
<h3 id="下载包到本地"><strong>下载包到本地</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#下载包到本地" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="shell" data-theme="github-light github-dark"><code data-language="shell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -erobots=off</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -np</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reject=html,gif,A,D</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nH</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cut-dirs=4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -P</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/ http://mirrors.aliyun.com/centos/7/cloud/x86_64/openstack-train/</span></span></code></pre></figure>
<h3 id="配置本地yum"><strong>配置本地YUM</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#配置本地yum" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>/etc/yum.repos.d/Openstack-Train.repo</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="shell" data-theme="github-light github-dark"><code data-language="shell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Openstack-Train]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Openstack-Train</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">baseurl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">file:///opt/openstack-train/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpgcheck</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span></code></pre></figure>
<p>挂载光盘</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /mnt/cdrom</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mount</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iso9660 -o loop /dev/cdrom /mnt/cdrom</span></span></code></pre></figure>
<p>cat /etc/yum.repos.d/CentOS-iso.repo</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="shell" data-theme="github-light github-dark"><code data-language="shell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[CenOS-iso]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CenOS-iso</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">baseurl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">file:///mnt/cdrom/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpgcheck</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span></code></pre></figure>
<p>写入配置文件，/etc/fstab</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="shell" data-theme="github-light github-dark"><code data-language="shell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/dev/cdrom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /mnt/cdrom iso9660 defaults,loop </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></figure>
<p>启用YUM缓存</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="shell" data-theme="github-light github-dark"><code data-language="shell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@centos7 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# cat /etc/yum.conf</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[main]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cachedir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/var/cache/yum/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$basearch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$releasever</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">keepcache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></figure>
<h3 id="基础工具安装"><strong>基础工具安装</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#基础工具安装" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="shell" data-theme="github-light github-dark"><code data-language="shell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install net-tools</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install wget</span></span></code></pre></figure>
<h3 id="更改主机名"><strong>更改主机名</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#更改主机名" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li>不同角色不同名字分别设置</li>
</ul>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="shell" data-theme="github-light github-dark"><code data-language="shell" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname ctl01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname compute01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname neutron01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname cinder01</span></span></code></pre></figure>
<h3 id="配置网络"><strong>配置网络</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#配置网络" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>由于使用VMware Workstation进行部署，需要更改原有的网络配置</p>
<h4 id="主机管理网络"><strong>主机管理网络</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#主机管理网络" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114225433.png" width="auto" height="auto" alt/></p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114225512.png" width="auto" height="auto" alt/></p>
<blockquote>
<p>注意NAT设置中，设置的网关IP与本机对应虚拟网卡IP不可一致，否则无法正常与外网通信，该问题由于VMware Workstation虚拟实现的NAT和DHCP造成，网关是虚拟机的交换设备，本机vmnet8和对应ip则作为通信载体，不可使用同一个IP</p>
</blockquote>
<p>相关参考：<a href="https://blog.51cto.com/u_13648313/2164309" class="external">https://blog.51cto.com/u_13648313/2164309<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p>NAT配置网关为10.191.101.2</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114225532.png" width="auto" height="auto" alt/></p>
<blockquote>
<p>主机对应网卡地址则配置为10.191.101.1，此外需指定配置DNS Server，否则虚拟主机无法解析域名，如果部分虚拟机无法正常获取DNS Server地址，亦可在虚拟机网卡配置中写入DNS Server</p>
</blockquote>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114225556.png" width="auto" height="auto" alt/></p>
<p>控制节点</p>
<p>cat /etc/sysconfig/network-scripts/ifcfg-ens33</p>
<pre><code>TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
NAME=ens33
DEVICE=ens33
ONBOOT=yes
IPADDR=10.191.101.128
NETMASK=255.255.255.0
GATEWAY=10.191.101.2
</code></pre>
<p>计算节点</p>
<p>cat /etc/sysconfig/network-scripts/ifcfg-ens33</p>
<pre><code>TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
NAME=ens33
DEVICE=ens33
ONBOOT=yes
IPADDR=10.191.101.129
NETMASK=255.255.255.0
GATEWAY=10.191.101.2
</code></pre>
<h4 id="虚拟机流量网络"><strong>虚拟机流量网络</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#虚拟机流量网络" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114225700.png" width="auto" height="auto" alt/></p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114225717.png" width="auto" height="auto" alt/></p>
<p>控制节点</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/sysconfig/network-scripts/ifcfg-ens33 /etc/sysconfig/network-scripts/ifcfg-ens34</span></span></code></pre></figure>
<p>cat /etc/sysconfig/network-scripts/ifcfg-ens34</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TYPE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ethernet</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BOOTPROTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">static</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DEFROUTE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yes</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ens34</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DEVICE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ens34</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ONBOOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yes</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">IPADDR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.80.128</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NETMASK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255.255</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.255.0</span></span></code></pre></figure>
<p>计算节点
cat /etc/sysconfig/network-scripts/ifcfg-ens34</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TYPE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ethernet</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BOOTPROTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">static</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DEFROUTE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yes</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ens34</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DEVICE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ens34</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ONBOOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yes</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">IPADDR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.80.129</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NETMASK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255.255</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.255.0</span></span></code></pre></figure>
<h4 id="新增win-compute对网络的调整可选">新增win compute对网络的调整（可选）<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#新增win-compute对网络的调整可选" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>在hyperv交换机管理新增一个内部交换机</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240514174408.png" alt/></p>
<p>在宿主机（本机）确认创建的交换机信息</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240514174609.png" alt/></p>
<p>在workstation中修改或创建桥接网络到hyperv虚拟交换机</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240514175212.png" alt/></p>
<p>调整其他openstack节点，例如控制节点，连接到桥接hyperv交换机的网卡</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240514175335.png" alt/></p>
<p>在hyperv虚拟机（计算节点）中配置与其他节点指定网卡同网段地址测试</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240514175527.png" alt/></p>
<p>测试网络连接</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240514175637.png" alt/></p>
<h3 id="关闭selinux"><strong>关闭selinux</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#关闭selinux" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 's|SELINUX=enforcing|SELINUX=disabled|'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/selinux/config</span></span></code></pre></figure>
<h3 id="连接数配置"><strong>连接数配置</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#连接数配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '* soft nofile 65530</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">* hard nofile 65530</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">* soft nproc 65530</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">* hard nproc 65530'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">>></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/security/limits.conf</span></span></code></pre></figure>
<h3 id="关闭防火墙"><strong>关闭防火墙</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#关闭防火墙" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable firewalld</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop firewalld</span></span></code></pre></figure>
<h3 id="关闭networkmanager"><strong>关闭NetworkManager</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#关闭networkmanager" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable NetworkManager</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop NetworkManager</span></span></code></pre></figure>
<h3 id="hosts文件配置"><strong>HOSTS文件配置</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hosts文件配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '10.191.101.128 ctl01</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10.191.101.129 compute01</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10.191.101.130 neutron01</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10.191.101.131 cinder01</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10.191.101.140 ceph01'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">>></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/hosts</span></span></code></pre></figure>
<h3 id="ntp时钟同步"><strong>NTP时钟同步</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ntp时钟同步" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install -y chrony</span></span></code></pre></figure>
<p>计算节点将server修改为控制节点ip</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;server 10.191.101.128 iburst&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/chrony.conf</span></span></code></pre></figure>
<p>同步时间</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable chronyd.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart chronyd.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chronyc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sources</span></span></code></pre></figure>
<h2 id="数据库"><strong>数据库</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#数据库" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<blockquote>
<p>Most OpenStack services use an SQL database to store information.</p>
</blockquote>
<p>安装软件包</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install mariadb mariadb-server python2-PyMySQL</span></span></code></pre></figure>
<p>创建并编辑 /etc/my.cnf.d/openstack.cnf</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mysqld]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bind</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">191</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">101</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">default-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">storage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">engine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> innodb</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">innodb_file_per_table</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">max_connections </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4096</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">collation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8_general_ci</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">character-set-server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8</span></span></code></pre></figure>
<p>启动数据库，配置开机启动</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable mariadb.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart mariadb.service</span></span></code></pre></figure>
<p>初始化数据库,本次测试配置密码为Abc-1234</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql_secure_installation</span></span></code></pre></figure>
<p>（可选）配置远程root登录</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Welcome </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> the MariaDB monitor.  Commands </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \g.</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Your MariaDB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">connection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MariaDB MariaDB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Server</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Copyright (c) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2018</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Oracle, MariaDB Corporation Ab </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> others.</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'help;'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '\h'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> help. </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '\c'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> to</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> the current input </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">statement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MariaDB [(none)]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mysql;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reading </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> information </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> completion of </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">table</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> column names</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">You can turn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> this feature </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">to</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a quicker startup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">A</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Database</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> changed</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MariaDB [mysql]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> host,user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-----------+------+</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| host      | user |</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-----------+------+</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">127</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| ::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| ctl01     | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| localhost | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-----------+------+</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> rows</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sec)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MariaDB [mysql]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'root'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'%'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> GRANT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OPTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Query OK, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> rows</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> affected (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sec)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MariaDB [mysql]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> host,user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-----------+------+</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| host      | user |</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-----------+------+</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| %         | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">127</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| ::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">| ctl01     | </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> |</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-----------+------+</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> rows</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sec)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MariaDB [mysql]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FLUSH PRIVILEGES;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Query OK, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> rows</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> affected (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sec)</span></span>
<span data-line> </span></code></pre></figure>
<h2 id="消息队列"><strong>消息队列</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#消息队列" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<blockquote>
<p>OpenStack uses a message queue to coordinate operations and status information among services.</p>
</blockquote>
<p>安装</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install rabbitmq-server</span></span></code></pre></figure>
<p>开机启动</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable rabbitmq-server.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart rabbitmq-server.service</span></span></code></pre></figure>
<p>新增openstack用户</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rabbitmqctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_user openstack Abc-1234</span></span></code></pre></figure>
<p>为用户配置权限</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rabbitmqctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set_permissions openstack &quot;.*&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.*&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.*&quot;</span></span></code></pre></figure>
<p>检查状态</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status rabbitmq-server.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nltp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5672</span></span></code></pre></figure>
<h2 id="memcached"><strong>Memcached</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#memcached" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<blockquote>
<p>The Identity service authentication mechanism for services uses Memcached to cache tokens.</p>
</blockquote>
<p>安装</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install memcached python-memcached</span></span></code></pre></figure>
<p>配置/etc/sysconfig/memcached，允许访问的ip</p>
<blockquote>
<p>Configure the service to use the management IP address of the controller node. This is to enable access by other nodes via the management network</p>
</blockquote>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;11211&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">USER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;memcached&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MAXCONN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1024&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CACHESIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;64&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OPTIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-l 127.0.0.1,::1,ctl01&quot;</span></span></code></pre></figure>
<p>配置开机启动</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable memcached.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart memcached.service</span></span></code></pre></figure>
<p>检查状态</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status memcached.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nltup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11211</span></span></code></pre></figure>
<h2 id="etcd"><strong>Etcd</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#etcd" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<blockquote>
<p>OpenStack services may use Etcd, a distributed reliable key-value store for distributed key locking, storing configuration, keeping track of service live-ness and other scenarios.</p>
</blockquote>
<p>安装</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install etcd</span></span></code></pre></figure>
<p>备份和修改配置</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/etcd/etcd.conf{,.bak}</span></span></code></pre></figure>
<blockquote>
<p>set the <code>ETCD_INITIAL_CLUSTER</code>, <code>ETCD_INITIAL_ADVERTISE_PEER_URLS</code>, <code>ETCD_ADVERTISE_CLIENT_URLS</code>, <code>ETCD_LISTEN_CLIENT_URLS</code> to the management IP address of the controller node to enable access by other nodes via the management network</p>
</blockquote>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#[Member]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ETCD_DATA_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/var/lib/etcd/default.etcd&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ETCD_LISTEN_PEER_URLS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://10.191.101.128:2380&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ETCD_LISTEN_CLIENT_URLS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://10.191.101.128:2379&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ETCD_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ctl01&quot;</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#[Clustering]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://10.191.101.128:2380&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ETCD_ADVERTISE_CLIENT_URLS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://10.191.101.128:2379&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ETCD_INITIAL_CLUSTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ctl01=http://10.191.101.128:2380&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ETCD_INITIAL_CLUSTER_TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;etcd-cluster-01&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ETCD_INITIAL_CLUSTER_STATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;new&quot;</span></span></code></pre></figure>
<p>配置开机启动和检查状态</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable etcd</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart etcd</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status etcd</span></span></code></pre></figure>
<h2 id="密码规划"><strong>密码规划</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#密码规划" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>































































































<div class="table-container"><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>Password name</strong></td><td><strong>Description</strong></td><td><strong>Key</strong></td></tr><tr><td>Database password (no variable used)</td><td>Root password for the database</td><td>Abc-1234</td></tr><tr><td><strong>ADMIN_PASS</strong></td><td>Password of user <strong>admin</strong></td><td>Abc-1234</td></tr><tr><td><strong>CINDER_DBPASS</strong></td><td>Database password for the Block Storage service</td><td>Abc-1234</td></tr><tr><td><strong>CINDER_PASS</strong></td><td>Password of Block Storage service user <strong>cinder</strong></td><td>Abc-1234</td></tr><tr><td><strong>DASH_DBPASS</strong></td><td>Database password for the Dashboard</td><td>Abc-1234</td></tr><tr><td><strong>DEMO_PASS</strong></td><td>Password of user <strong>demo</strong></td><td>Abc-1234</td></tr><tr><td><strong>GLANCE_DBPASS</strong></td><td>Database password for Image service</td><td>Abc-1234</td></tr><tr><td><strong>GLANCE_PASS</strong></td><td>Password of Image service user <strong>glance</strong></td><td>Abc-1234</td></tr><tr><td><strong>KEYSTONE_DBPASS</strong></td><td>Database password of Identity service</td><td>Abc-1234</td></tr><tr><td><strong>METADATA_SECRET</strong></td><td>Secret for the metadata proxy</td><td>Abc-1234</td></tr><tr><td><strong>NEUTRON_DBPASS</strong></td><td>Database password for the Networking service</td><td>Abc-1234</td></tr><tr><td><strong>NEUTRON_PASS</strong></td><td>Password of Networking service user <strong>neutron</strong></td><td>Abc-1234</td></tr><tr><td><strong>NOVA_DBPASS</strong></td><td>Database password for Compute service</td><td>Abc-1234</td></tr><tr><td><strong>NOVA_PASS</strong></td><td>Password of Compute service user <strong>nova</strong></td><td>Abc-1234</td></tr><tr><td><strong>PLACEMENT_PASS</strong></td><td>Password of the Placement service user <strong>placement</strong></td><td>Abc-1234</td></tr><tr><td><strong>RABBIT_PASS</strong></td><td>Password of RabbitMQ user <strong>openstack</strong></td><td>Abc-1234</td></tr></tbody></table></div>
<h2 id="minimal-deployment-for-train"><strong>Minimal deployment for Train</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#minimal-deployment-for-train" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<blockquote>
<p>本次安装train版本，其他版本可参考官网相关手册，最小化的train版本安装必须包含下面的这些服务，逐步开始</p>
</blockquote>
<blockquote>
<p>At a minimum, you need to install the following services. Install the services in the order specified below</p>
</blockquote>
<ul>
<li>
<p>Identity service – keystone installation for Train
<a href="https://docs.openstack.org/keystone/train/install/" class="external">https://docs.openstack.org/keystone/train/install/<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
</li>
<li>
<p>Image service – glance installation for Train
<a href="https://docs.openstack.org/glance/train/install/" class="external">https://docs.openstack.org/glance/train/install/<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
</li>
<li>
<p>Placement service – placement installation for Train
<a href="https://docs.openstack.org/placement/train/install/" class="external">https://docs.openstack.org/placement/train/install/<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
</li>
<li>
<p>Compute service – nova installation for Train
<a href="https://docs.openstack.org/nova/train/install/" class="external">https://docs.openstack.org/nova/train/install/<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
</li>
<li>
<p>Networking service – neutron installation for Train
<a href="https://docs.openstack.org/neutron/train/install/" class="external">https://docs.openstack.org/neutron/train/install/<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
</li>
</ul>
<blockquote>
<p>We advise to also install the following components after you have installed the minimal deployment services</p>
</blockquote>
<ul>
<li>
<p>Dashboard – horizon installation for Train
<a href="https://docs.openstack.org/horizon/train/install/" class="external">https://docs.openstack.org/horizon/train/install/<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
</li>
<li>
<p>Block Storage service – cinder installation for Train
<a href="https://docs.openstack.org/cinder/train/install/" class="external">https://docs.openstack.org/cinder/train/install/<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
</li>
</ul>
<h3 id="keystone"><strong>Keystone</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#keystone" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<blockquote>
<p>The OpenStack Identity service provides a single point of integration for managing authentication, authorization, and a catalog of services.</p>
</blockquote>
<h4 id="先决条件"><strong>先决条件</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#先决条件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>在配置 OpenStack 身份认证服务前，必须创建一个数据库和管理员令牌</p>
<p>登录数据库</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root -p</span></span></code></pre></figure>
<p>创建和配置数据表</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> keystone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></figure>
<p>对<code>keystone</code>数据库授予恰当的权限</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> keystone.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'keystone'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> keystone.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'keystone'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'%'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></figure>
<h4 id="配置组件"><strong>配置组件</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#配置组件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>安装组件</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-keystone httpd mod_wsgi</span></span></code></pre></figure>
<p>备份和配置/etc/keystone/keystone.conf</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/keystone/keystone.conf{,.bak}</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/keystone/keystone.conf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">egrep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;#|^$&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[database]</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connection</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = mysql+pymysql://keystone:Abc-1234@ctl01/keystone</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[token]</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = fernet</span></span></code></pre></figure>
<p>填充数据库并验证</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;keystone-manage db_sync&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> keystone -e 'show tables'</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ERROR</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1045</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">28000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">: Access denied for user 'root'@'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (using </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">password: NO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<p>报错处理，备份和修改配置</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/my.cnf.d/mariadb-server.cnf{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/my.cnf.d/mariadb-server.cnf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;^$\|#&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mysqld]</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">skip-grant-tables</span></span></code></pre></figure>
<p>重启数据库检查</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart mariadb.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> keystone -e 'show tables'</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+------------------------------------+</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Tables_in_keystone</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                 |</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+------------------------------------+</span></span></code></pre></figure>
<p>初始化Fernet keys</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">keystone-manage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fernet_setup --keystone-user keystone --keystone-group keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">keystone-manage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> credential_setup --keystone-user keystone --keystone-group keystone</span></span></code></pre></figure>
<p>引导身份服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">keystone-manage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bootstrap --bootstrap-password Abc-1234 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--bootstrap-admin-url </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://ctl01:5000/v3/ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--bootstrap-internal-url </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://ctl01:5000/v3/ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--bootstrap-public-url </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://ctl01:5000/v3/ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--bootstrap-region-id </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">RegionOne</span></span></code></pre></figure>
<h4 id="配置apache-http服务器"><strong>配置Apache HTTP服务器</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#配置apache-http服务器" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>配置servername为控制节点</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/httpd/conf/httpd.conf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ServerName&quot;</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ServerName gives the name and port that the server uses to identify itself.</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ServerName</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ctl01</span></span></code></pre></figure>
<p>创建配置文件软连接</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span></span></code></pre></figure>
<p>配置开机启动和检查状态</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable httpd.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart httpd.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status httpd.service</span></span></code></pre></figure>
<p>为admin用户添加环境变量</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/admin-openrc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> EOF</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">export OS_USERNAME=admin</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">export OS_PASSWORD=Abc-1234</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">export OS_PROJECT_NAME=admin</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">export OS_USER_DOMAIN_NAME=Default</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">export OS_PROJECT_DOMAIN_NAME=Default</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">export OS_AUTH_URL=http://ctl01:5000/v3</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">export OS_IDENTITY_API_VERSION=3</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></figure>
<h4 id="创建域项目用户和角色"><strong>创建域，项目，用户和角色</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#创建域项目用户和角色" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>创建域的方法</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> domain create --description &quot;An Example Domain&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-bash:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openstack: command not found</span></span></code></pre></figure>
<p>报错处理，安装openstack客户端</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install python-openstackclient</span></span></code></pre></figure>
<p>创建service项目</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> project create --domain default --description &quot;Service Project&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span></span></code></pre></figure>
<p>创建myproject项目</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> project create --domain default --description &quot;Demo Project&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myproject</span></span></code></pre></figure>
<p>创建myuser用户，此处密码使用Abc-1234(—password-prompt为交互式,—password+密码为非交互式)</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user create --domain default --password-prompt myuser</span></span></code></pre></figure>
<p>创建myrole角色</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> role create myrole</span></span></code></pre></figure>
<p>查看角色</p>
<pre><code>[root@ctl01 ~]# openstack role list
+----------------------------------+--------+
| ID                               | Name   |
+----------------------------------+--------+
| 4bd9bb8d39564e99abefb2d576b72f7e | member |
| 5171abb30ef24b11b31f58f5cffe81a1 | myrole |
| 8e1a7c8613a045949fbc1ecdb14dcfe7 | reader |
| bfc42249d4504d908ea2c416ce655a4f | admin  |
+----------------------------------+--------+
</code></pre>
<p>将角色添加到myproject项目和myuser用户</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> role add --project myproject --user myuser myrole</span></span></code></pre></figure>
<h4 id="验证"><strong>验证</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#验证" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>取消环境变量</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">unset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> OS_AUTH_URL OS_PASSWORD</span></span></code></pre></figure>
<p>admin用户请求令牌验证</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --os-auth-url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://ctl01:5000/v3 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--os-project-domain-name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Default </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--os-user-domain-name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Default </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--os-project-name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">admin </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--os-username </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">admin token issue</span></span></code></pre></figure>
<p>myuser用户请求令牌验证</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --os-auth-url</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://ctl01:5000/v3 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--os-project-domain-name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Default </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--os-user-domain-name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Default </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--os-project-name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">myproject </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--os-username </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">myuser token issue</span></span></code></pre></figure>
<p>验证环境变量配置</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> token issue</span></span></code></pre></figure>
<h3 id="glance"><strong>Glance</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#glance" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="创建和配置数据库"><strong>创建和配置数据库</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#创建和配置数据库" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">u </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> glance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> glance.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'glance'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> glance.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'glance'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'%'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flush privileges;</span></span></code></pre></figure>
<p>创建glance用户</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user create --domain default --password-prompt glance</span></span></code></pre></figure>
<p>将admin加入service项目和glance用户</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> role add --project service --user glance admin</span></span></code></pre></figure>
<p>创建glance服务实体</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service create --name glance --description &quot;OpenStack Image&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span></span></code></pre></figure>
<p>创建glance服务API端点,OpenStack使用三种API端点变种代表每种服务：admin、internal、public</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne image public http://ctl01:9292</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne image internal http://ctl01:9292</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne image admin http://ctl01:9292</span></span></code></pre></figure>
<h4 id="安装glance软件包"><strong>安装glance软件包</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#安装glance软件包" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-glance</span></span></code></pre></figure>
<p>编辑glance配置文件 /etc/glance/glance-api.conf</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf</span></span></code></pre></figure>
<p>openstack-utils能够让openstack安装更加简单，直接在命令行修改配置文件</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-utils</span></span></code></pre></figure>
<h4 id="修改配置文件"><strong>修改配置文件</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#修改配置文件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>配置数据库访问</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf database connection  mysql+pymysql://glance:Abc-1234@ctl01/glance</span></span></code></pre></figure>
<p>配置身份服务访问</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf keystone_authtoken www_authenticate_uri   http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf keystone_authtoken auth_url  http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf keystone_authtoken memcached_servers  ctl01:11211</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf keystone_authtoken auth_type  password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf keystone_authtoken project_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf keystone_authtoken user_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf keystone_authtoken project_name  service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf keystone_authtoken username  glance</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf keystone_authtoken password  Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf paste_deploy flavor  keystone</span></span></code></pre></figure>
<p>配置本地文件系统和镜像文件位置</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf glance_store stores  file,http</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf glance_store default_store  file</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf glance_store filesystem_store_datadir  /var/lib/glance/images/</span></span></code></pre></figure>
<p>填充数据库</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;glance-manage db_sync&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> glance</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 忽略此输出中的任何弃用消息</span></span></code></pre></figure>
<p>开机启动</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable openstack-glance-api.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-glance-api.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status openstack-glance-api.service</span></span></code></pre></figure>
<p>glance 启动报错处理：注意配置文件中是否含有特殊编码字符，在文本编辑器中检查</p>
<pre><code>Dec 18 10:09:28 ctl01 glance-api[7727]: ERROR: 'ascii' codec can't decode byte 0xc2 in position 11: ordinal not in range(128)
</code></pre>
<p>解决方式：更换编码方式
问题原因，ascii编码方式不能编码其他的内容
在 cd /usr/lib/python2.7/site-packages/目录下新建一个文件sitecustomize.py
内容为</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sitecustomize.py</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># this file can be anywhere in your Python path,</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># but it usually goes in ${pythondir}/lib/site-packages/</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sys</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sys.setdefaultencoding(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'utf-8'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<p>再填充数据库即可</p>
<h4 id="验证-1"><strong>验证</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#验证-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>下载cirros镜像</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 速度较慢，可浏览器进行下载后上传到控制节点</span></span></code></pre></figure>
<p>上传镜像</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 不推荐使用官方文档glance image-create这样的写法，新版本的OpenStack已经不支持，统一使用以openstack开头的命令写法</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image create --file ~/cirros-0.4.0-x86_64-disk.img --disk-format qcow2 --container-format bare --public cirros</span></span></code></pre></figure>
<p>查看镜像</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image list</span></span></code></pre></figure>
<p>查看镜像本地文件</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ll</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/glance/images/</span></span></code></pre></figure>
<h3 id="placement"><strong>Placement</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#placement" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<blockquote>
<p>The placement service enables other projects to track their own resources. Those projects can register/delete their own resources to/from placement via the placement <a href="https://docs.openstack.org/api-ref/placement/" class="external">HTTP API<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>.</p>
</blockquote>
<h4 id="创建和配置数据库-1"><strong>创建和配置数据库</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#创建和配置数据库-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">u </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> placement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></figure>
<p>授予权限</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> placement.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'placement'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> placement.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'placement'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'%'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></figure>
<p>配置生效</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flush privileges;</span></span></code></pre></figure>
<p>创建用户和添加到项目中，此处配置密码Abc-1234</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user create --domain default --password-prompt placement</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> role add --project service --user placement admin</span></span></code></pre></figure>
<p>创建服务实体</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service create --name placement --description &quot;Placement API&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> placement</span></span></code></pre></figure>
<p>创建placement API服务访问端点</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne placement public http://ctl01:8778</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne placement internal http://ctl01:8778</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne placement admin http://ctl01:8778</span></span></code></pre></figure>
<h4 id="安装placement软件包"><strong>安装placement软件包</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#安装placement软件包" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-placement-api</span></span></code></pre></figure>
<h4 id="备份和修改配置"><strong>备份和修改配置</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#备份和修改配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf /etc/placement/placement.conf.bak</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf placement_database connection mysql+pymysql://placement:Abc-1234@ctl01/placement</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf api auth_strategy keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf keystone_authtoken auth_url  http://ctl01:5000/v3</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf keystone_authtoken memcached_servers ctl01:11211</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf keystone_authtoken auth_type password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf keystone_authtoken project_domain_name Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf keystone_authtoken user_domain_name Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf keystone_authtoken project_name service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf keystone_authtoken username placement</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/placement/placement.conf keystone_authtoken password Abc-1234</span></span></code></pre></figure>
<p>填充placement数据库</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ctl01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# su -s /bin/sh -c </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;placement-manage db sync&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> placement</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/lib/python2.7/site-packages/pymysql/cursors.py:170:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Warning: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1280,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> u&quot;Name 'alembic_version_pkc' ignored for PRIMARY key.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  result</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = self._query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<p>报错处理，再执行一次</p>
<pre><code>[root@ctl01 ~]# su -s /bin/sh -c &quot;placement-manage db sync&quot; placement
</code></pre>
<p>修改placement的apache配置文件，官方文档没有提到，如果不修改，计算服务检查时将会报错</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#启用placement API访问，在16行下增加下列配置段</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/httpd/conf.d/00-placement-api.conf</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SSLCertificateKeyFile</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#SSLCertificateKeyFile ...</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Directory /usr/bin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">IfVersion </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">= 2.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">4></span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Require</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all granted</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/IfVersion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">IfVersion </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 2.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">4></span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Order</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allow,deny</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Allow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from all</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/IfVersion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/Directory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span></code></pre></figure>
<h4 id="重启apache服务验证">重启apache服务验证<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#重启apache服务验证" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart httpd.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status httpd.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -lntup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8778</span></span></code></pre></figure>
<p>curl测试返回json</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ctl01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# curl http://ctl01:8778</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;versions&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;status&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CURRENT&quot;, &quot;min_version&quot;: &quot;1.0&quot;, &quot;max_version&quot;: &quot;1.36&quot;, &quot;id&quot;: &quot;v1.0&quot;, &quot;links&quot;: [{&quot;href&quot;: &quot;&quot;, &quot;rel&quot;: &quot;self&quot;}]}]}</span></span></code></pre></figure>
<p>验证检查健康状态</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">placement-status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade check</span></span></code></pre></figure>
<h3 id="nova"><strong>Nova</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#nova" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="控制节点"><strong>控制节点</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#控制节点" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>创建nova_api，nova和nova_cell0数据库并授权</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nova_api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nova</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nova_cell0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nova_api.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'nova'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nova_api.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'nova'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'%'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nova.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'nova'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nova.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'nova'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'%'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nova_cell0.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'nova'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nova_cell0.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'nova'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'%'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flush privileges;</span></span></code></pre></figure>
<p>创建和配置nova账户</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user create --domain default --password Abc-1234 nova</span></span></code></pre></figure>
<p>向nova用户添加admin角色</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> role add --project service --user nova admin</span></span></code></pre></figure>
<p>创建nova服务实体</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service create --name nova --description &quot;OpenStack Compute&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compute</span></span></code></pre></figure>
<p>创建Compute API服务端点</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne compute public http://ctl01:8774/v2.1</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne compute internal http://ctl01:8774/v2.1</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne compute admin http://ctl01:8774/v2.1</span></span></code></pre></figure>
<p>安装Nova相关软件包</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-nova-api openstack-nova-conductor openstack-nova-novncproxy openstack-nova-scheduler</span></span></code></pre></figure>
<p>备份和编辑nova配置文件/etc/nova/nova.conf</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In the `[vnc]` section, configure the VNC proxy to use the management interface IP address of the controller node</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">my_ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.128</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf DEFAULT enabled_apis  osapi_compute,metadata</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf DEFAULT my_ip &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$my_ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf DEFAULT use_neutron  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf DEFAULT firewall_driver  nova.virt.firewall.NoopFirewallDriver</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf DEFAULT transport_url  rabbit://openstack:Abc-1234@ctl01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf api_database connection  mysql+pymysql://nova:Abc-1234@ctl01/nova_api</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf database connection  mysql+pymysql://nova:Abc-1234@ctl01/nova</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf placement_database connection  mysql+pymysql://placement:Abc-1234@ctl01/placement</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf api auth_strategy  keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf keystone_authtoken auth_url  http://ctl01:5000/v3</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf keystone_authtoken memcached_servers  ctl01:11211</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf keystone_authtoken auth_type  password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf keystone_authtoken project_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf keystone_authtoken user_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf keystone_authtoken project_name  service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf keystone_authtoken username  nova</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf keystone_authtoken password  Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf vnc enabled  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf vnc server_listen  '$my_ip'</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf vnc server_proxyclient_address  '$my_ip'</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf glance api_servers  http://ctl01:9292</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf oslo_concurrency lock_path  /var/lib/nova/tmp</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf placement region_name  RegionOne</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf placement project_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf placement project_name  service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf placement auth_type  password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf placement user_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf placement auth_url  http://ctl01:5000/v3</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf placement username  placement</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf placement password  Abc-1234</span></span></code></pre></figure>
<p>填充nova-api数据库</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;nova-manage api_db sync&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nova</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;nova-manage cell_v2 map_cell0&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nova</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nova</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;nova-manage db sync&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nova</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/lib/python2.7/site-packages/pymysql/cursors.py:170:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Warning: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1831,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> u'Duplicate index `block_device_mapping_instance_uuid_virtual_name_device_name_idx`. This is deprecated and will be disallowed in a future release'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  result</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = self._query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/lib/python2.7/site-packages/pymysql/cursors.py:170:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Warning: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1831,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> u'Duplicate index `uniq_instances0uuid`. This is deprecated and will be disallowed in a future release'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  result</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = self._query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<p>报错处理，再执行一次</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;nova-manage db sync&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nova</span></span></code></pre></figure>
<p>验证nova cell0和cell1是否正确注册</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;nova-manage cell_v2 list_cells&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nova</span></span></code></pre></figure>
<p>配置开机启动和启动服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-api.service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-scheduler.service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-conductor.service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-novncproxy.service</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-api.service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-scheduler.service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-conductor.service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-novncproxy.service</span></span></code></pre></figure>
<p>检查运行状态</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-api.service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-scheduler.service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-conductor.service </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack-nova-novncproxy.service</span></span></code></pre></figure>
<p>检查nova服务状态</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tnlup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">egrep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '8774|8775'</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://ctl01:8774</span></span></code></pre></figure>
<h4 id="计算节点"><strong>计算节点</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#计算节点" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>安装软件包</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-nova-compute</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-utils</span></span></code></pre></figure>
<p>备份和编辑nova配置文件</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">my_ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.129</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf DEFAULT enabled_apis  osapi_compute,metadata</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf DEFAULT transport_url  rabbit://openstack:Abc-1234@ctl01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf DEFAULT my_ip &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$my_ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf DEFAULT use_neutron  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf DEFAULT firewall_driver  nova.virt.firewall.NoopFirewallDriver</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf api auth_strategy  keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf keystone_authtoken auth_url  http://ctl01:5000/v3</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf keystone_authtoken memcached_servers  ctl01:11211</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf keystone_authtoken auth_type  password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf keystone_authtoken project_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf keystone_authtoken user_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf keystone_authtoken project_name  service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf keystone_authtoken username  nova</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf keystone_authtoken password  Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf vnc enabled  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf vnc server_listen  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.0.0</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf vnc server_proxyclient_address '$my_ip'</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf vnc novncproxy_base_url http://ctl01:6080/vnc_auto.html</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf glance api_servers  http://ctl01:9292</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf oslo_concurrency lock_path  /var/lib/nova/tmp</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf placement region_name  RegionOne</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf placement project_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf placement project_name  service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf placement auth_type  password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf placement user_domain_name  Default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf placement auth_url  http://ctl01:5000/v3</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf placement username  placement</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf placement password  Abc-1234</span></span></code></pre></figure>
<p>确定计算节点是否支持虚拟机硬件加速</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">egrep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '(vmx|svm)'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /proc/cpuinfo</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果此命令返回值不是0，则计算节点支持硬件加速，不需要加入下面的配置。</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果此命令返回值是0，则计算节点不支持硬件加速，并且必须配置libvirt为使用QEMU而不是KVM，需要编辑/etc/nova/nova.conf 配置文件中的[libvirt]部分：</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf libvirt virt_type  qemu</span></span></code></pre></figure>
<p>启动计算节点的nova服务及其相关服务，并设置开机自启</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果nova-compute服务无法启动，请检查 /var/log/nova/nova-compute.log，该错误消息可能表明控制器节点上的防火墙阻止访问端口5672，将防火墙配置为打开控制器节点上的端口5672并重新启动计算节点上的服务</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart libvirtd.service openstack-nova-compute.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable libvirtd.service openstack-nova-compute.service</span></span></code></pre></figure>
<p>在控制节点（ctl01）上验证计算节点</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compute service list --service nova-compute</span></span></code></pre></figure>
<p>控制节点上发现计算主机</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加每台新的计算节点时，必须在控制器节点上运行以下命令以注册这些新的计算节点</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;nova-manage cell_v2 discover_hosts --verbose&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nova</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 也可以设置适当的发现时间间隔来添加新的计算节点</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf scheduler discover_hosts_in_cells_interval </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-nova-api.service</span></span></code></pre></figure>
<h4 id="在控制节点上验证nova服务"><strong>在控制节点上验证nova服务</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#在控制节点上验证nova服务" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>列出服务组件以验证每个进程的成功启动和注册情况</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compute service list</span></span></code></pre></figure>
<p>列出身份服务中的API端点以验证与身份服务的连接</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> catalog list</span></span></code></pre></figure>
<p>列出镜像服务中的镜像以验证与镜像服务的连接性</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image list</span></span></code></pre></figure>
<p>检查Cells和placement API是否正常运行</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nova-status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> upgrade check</span></span></code></pre></figure>
<h4 id="windows计算节点">Windows计算节点<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#windows计算节点" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<h3 id="neutron"><strong>Neutron</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#neutron" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="控制节点-1"><strong>控制节点</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#控制节点-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>创建neutron数据库</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">uroot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pAbc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1234</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> neutron</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> neutron.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'neutron'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> neutron.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'neutron'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'%'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flush privileges;</span></span></code></pre></figure>
<p>创建neutron用户</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user create --domain default --password Abc-1234 neutron</span></span></code></pre></figure>
<p>向neutron用户添加admin角色</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> role add --project service --user neutron admin</span></span></code></pre></figure>
<p>创建neutron服务实体</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service create --name neutron --description &quot;OpenStack Networking&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network</span></span></code></pre></figure>
<p>创建neutron服务端点</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne network public http://ctl01:9696</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne network internal http://ctl01:9696</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne network admin http://ctl01:9696</span></span></code></pre></figure>
<h5 id="provider-networks"><strong>Provider Networks</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#provider-networks" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<p>安装neutron软件包</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># openstack-neutron：neutron-server的包</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># openstack-neutron-ml2：ML2 plugin的包</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># openstack-neutron-linuxbridge：linux bridge network provider相关的包</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ebtables：防火墙相关的包</span></span></code></pre></figure>
<p>编辑neutron服务配置文件/etc/neutron/neutron.conf</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置二层网络</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/neutron.conf{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/neutron.conf.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/neutron.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf database connection  mysql+pymysql://neutron:Abc-1234@ctl01/neutron</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT core_plugin ml2</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT service_plugins router</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT allow_overlapping_ips </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT transport_url  rabbit://openstack:Abc-1234@ctl01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT auth_strategy  keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_status_changes  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_data_changes  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken www_authenticate_uri  http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken auth_url  http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken memcached_servers  ctl01:11211</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken auth_type  password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken project_domain_name  default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken user_domain_name  default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken project_name  service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken username  neutron</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken password  Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf oslo_concurrency lock_path  /var/lib/neutron/tmp</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  auth_url http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  auth_type password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  project_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  user_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  region_name RegionOne</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  project_name service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  username nova</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  password Abc-1234</span></span></code></pre></figure>
<h5 id="ml2-plugin的配置文件ml2_confini"><strong>ML2 plugin的配置文件ml2_conf.ini</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ml2-plugin的配置文件ml2_confini" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 type_drivers  flat,vlan,vxlan</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 tenant_network_types vxlan</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 mechanism_drivers  linuxbridge,l2population</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 extension_drivers  port_security</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_flat flat_networks  provider</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini linux_bridge physical_interface_mappings provider:ens33</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_vxlan vni_ranges </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:1000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini securitygroup enable_ipset  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></figure>
<h5 id="配置linux网桥代理"><strong>配置linux网桥代理</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#配置linux网桥代理" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h5>
<p>Linux网桥代理为实例构建第2层（桥接和交换）虚拟网络基础结构并处理安全组</p>
<p>修改配置文件/etc/neutron/plugins/ml2/linuxbridge_agent.ini</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 官方配置文档中，</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PROVIDER_INTERFACE_NAME指的是eth0网卡，就是连接外部网络的那块网卡</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># OVERLAY_INTERFACE_IP_ADDRESS指的是控制节点访问外网的IP地址</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings  provider:ens33</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan local_ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.128</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan l2_population </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver  neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改linux内核参数设置为1</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'net.bridge.bridge-nf-call-iptables=1'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/sysctl.conf</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'net.bridge.bridge-nf-call-ip6tables=1'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/sysctl.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用网络桥接器支持，加载 br_netfilter 内核模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">modprobe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> br_netfilter</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span>
<span data-line> </span></code></pre></figure>
<p>配置第3层 l3代理为自助式虚拟网络提供路由和NAT服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置三层网络</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/l3_agent.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/l3_agent.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/l3_agent.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/l3_agent.ini DEFAULT interface_driver linuxbridge</span></span></code></pre></figure>
<p>配置DHCP代理，DHCP代理为虚拟网络提供DHCP服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改配置文件/etc/neutron/dhcp_agent.ini</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/dhcp_agent.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/dhcp_agent.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/dhcp_agent.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/dhcp_agent.ini DEFAULT interface_driver linuxbridge</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/dhcp_agent.ini DEFAULT dhcp_driver neutron.agent.linux.dhcp.Dnsmasq</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/dhcp_agent.ini DEFAULT enable_isolated_metadata </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></figure>
<p>配置元数据代理</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 元数据代理提供配置信息，例如实例的凭据</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改配置文件/etc/neutron/metadata_agent.ini ，并为元数据设置密码METADATA_SECRET</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/metadata_agent.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/metadata_agent.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/metadata_agent.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/metadata_agent.ini DEFAULT nova_metadata_host  controller</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/metadata_agent.ini DEFAULT metadata_proxy_shared_secret  Abc-1234</span></span>
<span data-line> </span></code></pre></figure>
<p>在控制节点上配置Nova服务与网络服务进行交互</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改配置文件/etc/nova/nova.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron url  http://ctl01:9696</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron auth_url  http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron auth_type  password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron project_domain_name  default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron user_domain_name  default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron region_name  RegionOne</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron project_name  service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron username  neutron</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron password  Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron service_metadata_proxy  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron metadata_proxy_shared_secret  Abc-1234</span></span></code></pre></figure>
<p>创建ml2的软连接 文件指向ML2插件配置的软链接</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span></span></code></pre></figure>
<p>填充数据库</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;neutron-db-manage --config-file /etc/neutron/neutron.conf </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> neutron</span></span></code></pre></figure>
<p>重新启动nova API计算服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-nova-api.service</span></span></code></pre></figure>
<p>启动neutron服务和配置开机启动</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service</span></span></code></pre></figure>
<p>因配置了第3层l3网络服务 需要启动第三层服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable neutron-l3-agent.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart neutron-l3-agent.service</span></span></code></pre></figure>
<h4 id="计算节点安装neutron服务"><strong>计算节点安装neutron服务</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#计算节点安装neutron服务" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>安装组件</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-neutron-linuxbridge ebtables ipset</span></span></code></pre></figure>
<p>修改neutron主配置文件/etc/neutron/neutron.conf</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/neutron.conf{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/neutron.conf.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/neutron.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT transport_url rabbit://openstack:Abc-1234@ctl01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT auth_strategy keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken www_authenticate_uri http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken auth_url http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken memcached_servers ctl01:11211</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken auth_type password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken project_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken user_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken project_name service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken username neutron</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken password Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf oslo_concurrency lock_path /var/lib/neutron/tmp</span></span></code></pre></figure>
<p>配置Linux网桥代理</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings  provider:ens33</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan local_ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.129</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan l2_population </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver  neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span></span></code></pre></figure>
<p>修改linux系统内核网桥参数为1</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'net.bridge.bridge-nf-call-iptables=1'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/sysctl.conf</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'net.bridge.bridge-nf-call-ip6tables=1'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/sysctl.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">modprobe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> br_netfilter</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span></code></pre></figure>
<p>配置计算节点上Nova服务使用网络服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改nova配置文件/etc/nova/nova.conf，添加neutron模块配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron auth_url http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron auth_type password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron project_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron user_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron region_name RegionOne</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron project_name service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron username neutron</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron password Abc-1234</span></span></code></pre></figure>
<p>重新启动计算节点上的Nova服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-nova-compute.service</span></span></code></pre></figure>
<p>启动neutron网桥代理服务 设置开机自启动</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable neutron-linuxbridge-agent.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart neutron-linuxbridge-agent.service</span></span></code></pre></figure>
<p>回到控制节点验证Neutron网络服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 列出已加载的扩展，以验证该neutron-server过程是否成功启动</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> extension list --network</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 列出代理商以验证成功</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network agent list</span></span></code></pre></figure>
<h4 id="安装neutron网络服务节点"><strong>安装neutron网络服务节点</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#安装neutron网络服务节点" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>网络配置按照官网文档的租户自助网络</p>
<p>配置系统参数</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'net.ipv4.ip_forward = 1'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/sysctl.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span></code></pre></figure>
<p>安装客户端</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install python-openstackclient</span></span></code></pre></figure>
<p>安装组件</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables openstack-utils</span></span></code></pre></figure>
<p>编辑neutron服务配置文件/etc/neutron/neutron.conf</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置二层网络</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/neutron.conf{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/neutron.conf.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/neutron.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf database connection  mysql+pymysql://neutron:Abc-1234@ctl01/neutron</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT core_plugin ml2</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT service_plugins router</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT allow_overlapping_ips </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT transport_url  rabbit://openstack:Abc-1234@ctl01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT auth_strategy  keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_status_changes  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf DEFAULT notify_nova_on_port_data_changes  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken www_authenticate_uri  http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken auth_url  http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken memcached_servers  ctl01:11211</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken auth_type  password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken project_domain_name  default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken user_domain_name  default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken project_name  service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken username  neutron</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf keystone_authtoken password  Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf oslo_concurrency lock_path  /var/lib/neutron/tmp</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  auth_url http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  auth_type password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  project_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  user_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  region_name RegionOne</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  project_name service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  username nova</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/neutron.conf nova  password Abc-1234</span></span></code></pre></figure>
<p>ML2 plugin的配置文件ml2_conf.ini</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 type_drivers  flat,vlan,vxlan</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 tenant_network_types vxlan</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 mechanism_drivers  linuxbridge,l2population</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2 extension_drivers  port_security</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_flat flat_networks  provider</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini ml2_type_vxlan vni_ranges </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:1000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini securitygroup enable_ipset  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></figure>
<p>配置Linux网桥代理</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Linux网桥代理为实例构建第2层（桥接和交换）虚拟网络基础结构并处理安全组</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改配置文件/etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 官网配置文档中：</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PROVIDER_INTERFACE_NAME指的是eth0网卡，就是连接外部网络的那块网卡</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># OVERLAY_INTERFACE_IP_ADDRESS指的是控制节点访问外网的IP地址</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini linux_bridge physical_interface_mappings  provider:ens33</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan enable_vxlan  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan local_ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.130</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini vxlan l2_population </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup enable_security_group  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/linuxbridge_agent.ini securitygroup firewall_driver  neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改linux内核参数设置为1</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'net.bridge.bridge-nf-call-iptables=1'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/sysctl.conf</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'net.bridge.bridge-nf-call-ip6tables=1'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/sysctl.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用网络桥接器支持，加载 br_netfilter 内核模块</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">modprobe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> br_netfilter</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span></span></code></pre></figure>
<p>配置第3层 l3代理为自助式虚拟网络提供路由和NAT服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置三层网络</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/l3_agent.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/l3_agent.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/l3_agent.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/l3_agent.ini DEFAULT interface_driver linuxbridge</span></span></code></pre></figure>
<p>配置DHCP代理，DHCP代理为虚拟网络提供DHCP服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改配置文件/etc/neutron/dhcp_agent.ini</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/dhcp_agent.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/dhcp_agent.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/dhcp_agent.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/dhcp_agent.ini DEFAULT interface_driver linuxbridge</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/dhcp_agent.ini DEFAULT dhcp_driver neutron.agent.linux.dhcp.Dnsmasq</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/dhcp_agent.ini DEFAULT enable_isolated_metadata </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></figure>
<p>配置元数据代理</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 元数据代理提供配置信息，例如实例的凭据</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修改配置文件/etc/neutron/metadata_agent.ini ，并为元数据设置密码METADATA_SECRET</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/metadata_agent.ini{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/metadata_agent.ini.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/metadata_agent.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/metadata_agent.ini DEFAULT nova_metadata_host  controller</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/neutron/metadata_agent.ini DEFAULT metadata_proxy_shared_secret  Abc-1234</span></span></code></pre></figure>
<p>创建ml2的软连接 文件指向ML2插件配置的软链接</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span></span></code></pre></figure>
<p>填充数据库</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> neutron</span></span></code></pre></figure>
<p>在ctl01控制节点上配置nova服务与网络节点服务进行交互
如果是单独安装网络节点则添加以下操作，如果已经在配置计算节点的网络服务时，在控制节点的配置文件/etc/nova/nova.conf添加了neutron模块 ,则不用再次添加</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron url  http://ctl01:9696  #此条官方文档未添加</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron auth_url  http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron auth_type  password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron project_domain_name  default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron user_domain_name  default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron region_name  RegionOne</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron project_name  service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron username  neutron</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron password  Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron service_metadata_proxy  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/nova/nova.conf neutron metadata_proxy_shared_secret  Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在ctl01控制节点上重新启动nova API计算服务</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-nova-api.service</span></span></code></pre></figure>
<p>回到网络节点启动neutron服务和配置开机启动</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart neutron-server.service neutron-linuxbridge-agent.service neutron-dhcp-agent.service neutron-metadata-agent.service</span></span></code></pre></figure>
<p>因配置了第3层l3网络服务 需要启动第三层服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable neutron-l3-agent.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart neutron-l3-agent.service</span></span></code></pre></figure>
<p>可以到控制节点再次验证Neutron网络服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 列出已加载的扩展，以验证该neutron-server过程是否成功启动</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> extension list --network</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 列出代理商以验证成功</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network agent list</span></span></code></pre></figure>
<h3 id="horizon"><strong>Horizon</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#horizon" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="在控制节点上安装horizon">在控制节点上安装horizon<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#在控制节点上安装horizon" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>安装软件包</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-dashboard</span></span></code></pre></figure>
<p>改配置文件/etc/openstack-dashboard/local_settings</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/openstack-dashboard/local_settings{,.bak}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '^$|#'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/openstack-dashboard/local_settings.bak</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/openstack-dashboard/local_settings</span></span></code></pre></figure>
<p>在控制节点上配置仪表盘以使用 OpenStack 服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ctl01&quot;</span></span></code></pre></figure>
<p>允许所有主机访问仪表板</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_HOSTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'*'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ]</span></span></code></pre></figure>
<p>配置 memcached 会话存储服务：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SESSION_ENGINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'django.contrib.sessions.backends.cache'</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CACHES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'default'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         'BACKEND'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'django.core.cache.backends.memcached.MemcachedCache'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         'LOCATION'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'ctl01:11211'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p>启用第3版认证API</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_KEYSTONE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:5000/v3&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> %</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> OPENSTACK_HOST</span></span></code></pre></figure>
<p>启用对域的支持</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span></code></pre></figure>
<p>配置API版本</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_API_VERSIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;identity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;volume&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p>通过仪表盘创建用户时的默认域配置为 default</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;default&quot;</span></span></code></pre></figure>
<p>通过仪表盘创建的用户默认角色配置为 user</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_KEYSTONE_DEFAULT_ROLE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;user&quot;</span></span></code></pre></figure>
<p>如果您选择网络参数1，禁用支持3层网络服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_NEUTRON_NETWORK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    ...</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_router'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_quotas'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_distributed_router'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_ha_router'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_lb'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_firewall'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_vpn'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_fip_topology_check'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p>可以选择性地配置时区</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TIME_ZONE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Asia/Shanghai&quot;</span></span></code></pre></figure>
<p>全部配置说明</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="python" data-theme="github-light github-dark"><code data-language="python" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">etc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">openstack</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dashboard</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">local_settings</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置仪表盘在ctl01节点上使用OpenStack服务</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ctl01&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 允许主机访问仪表板,接受所有主机,不安全不应在生产中使用</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_HOSTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'*'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ALLOWED_HOSTS = ['one.example.com', 'two.example.com']</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置memcached会话存储服务</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SESSION_ENGINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'django.contrib.sessions.backends.cache'</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CACHES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'default'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         'BACKEND'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'django.core.cache.backends.memcached.MemcachedCache'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         'LOCATION'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'ctl01:11211'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用身份API版本3</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_KEYSTONE_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:5000/v3&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> %</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> OPENSTACK_HOST</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用对域的支持</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置API版本</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_API_VERSIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;identity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;volume&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置Default为通过仪表板创建的用户的默认域</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Default&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置user为通过仪表板创建的用户的默认角色</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_KEYSTONE_DEFAULT_ROLE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;user&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果选择网络选项1，请禁用对第3层网络服务的支持,如果选择网络选项2,则可以打开</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OPENSTACK_NEUTRON_NETWORK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自动分配的网络</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_auto_allocated_network'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Neutron分布式虚拟路由器（DVR）</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_distributed_router'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># FIP拓扑检查</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_fip_topology_check'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 高可用路由器模式</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_ha_router'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下面三个已过时,不用过多了解,官方文档配置中是关闭的</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_lb'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_firewall'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_vpn'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ipv6网络</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_ipv6'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Neutron配额功能</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_quotas'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rbac政策</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_rbac_policy'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 路由器的菜单和浮动IP功能,如果Neutron部署有三层功能的支持可以打开</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'enable_router'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认的DNS名称服务器</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'default_dns_nameservers'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [],</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 网络支持的提供者类型,在创建网络时，该列表中的网络类型可供选择</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'supported_provider_types'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'*'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用与提供网络ID范围,仅涉及到VLAN，GRE，和VXLAN网络类型</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'segmentation_id_range'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {},</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用与提供网络类型</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    'extra_provider_types'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {},</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 支持的vnic类型,用于与端口绑定扩展</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 'supported_vnic_types': ['*'],</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 物理网络</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 'physical_networks': [],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置时区为亚洲上海</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TIME_ZONE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Asia/Shanghai&quot;</span></span></code></pre></figure>
<p>重建apache的dashboard配置文件</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/openstack-dashboard</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> manage.py make_web_conf --apache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/httpd/conf.d/openstack-dashboard.conf</span></span></code></pre></figure>
<p>重新启动节点上的apache服务和memcache服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart httpd.service memcached.service</span></span></code></pre></figure>
<p>访问dashboard</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http://10.191.101.128</span></span></code></pre></figure>
<p>若不能正常访问，请操作以下步骤:建立策略文件（policy.json）的软链接，否则登录到dashboard将出现权限错误和显示混乱</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/openstack-dashboard /usr/share/openstack-dashboard/openstack_dashboard/conf</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># /etc/httpd/conf.d/openstack-dashboard.conf 如果未包含，则添加以下行</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WSGIApplicationGroup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> %{GLOBAL}</span></span></code></pre></figure>
<h4 id="身份认证dashboard无法打开">身份认证dashboard无法打开<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#身份认证dashboard无法打开" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/httpd/conf.d/openstack-dashboard.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将原有的配置注释掉</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#WSGIScriptAlias / /usr/share/openstack-dashboard/openstack_dashboard/wsgi.py</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#Alias /static /usr/share/openstack-dashboard/static</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加以下配置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WSGIScriptAlias</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dashboard /usr/share/openstack-dashboard/openstack_dashboard/wsgi/django.wsgi</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Alias</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dashboard/static /usr/share/openstack-dashboard/static</span></span></code></pre></figure>
<p>在local_settings底下新增根目录指向</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/openstack-dashboard/local_settings</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WEBROOT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = '/dashboard/'</span></span></code></pre></figure>
<p>编辑以下文件，找到WEBROOT = ’/’ 修改为WEBROOT = ‘/dashboard’</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/openstack-dashboard/openstack_dashboard/defaults.py</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/openstack-dashboard/openstack_dashboard/test/settings.py</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/openstack-dashboard/static/dashboard/js/xxxx.js</span></span></code></pre></figure>
<p>修改后重启服务即可</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart httpd.service memcached.service</span></span></code></pre></figure>
<h3 id="cinder"><strong>Cinder</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#cinder" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="控制节点配置"><strong>控制节点配置</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#控制节点配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>在控制节点（ctl01：10.191.101.128）上配置</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">u </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p</span></span></code></pre></figure>
<p>创建数据库并授权</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sql" data-theme="github-light github-dark"><code data-language="sql" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DATABASE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cinder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cinder.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'cinder'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'localhost'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cinder.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'cinder'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'%'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 'Abc-1234'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flush privileges;</span></span></code></pre></figure>
<p>创建cinder用户</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user create --domain default --password Abc-1234 cinder</span></span></code></pre></figure>
<p>赋予Cinder权限为admin</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> role add --project service --user cinder admin</span></span></code></pre></figure>
<p>创建 cinder服务实体</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service create --name cinderv2 --description &quot;OpenStack Block Storage&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volumev2</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service create --name cinderv3 --description &quot;OpenStack Block Storage&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volumev3</span></span></code></pre></figure>
<p>创建块设备存储服务的 API 入口点</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne volumev2 public http://ctl01:8776/v2/%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne volumev2 internal http://ctl01:8776/v2/%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne volumev2 admin http://ctl01:8776/v2/%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne volumev3 public http://ctl01:8776/v3/%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne volumev3 internal http://ctl01:8776/v3/%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> endpoint create --region RegionOne volumev3 admin http://ctl01:8776/v3/%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span></span></code></pre></figure>
<p>安装软件包</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install -y openstack-cinder</span></span></code></pre></figure>
<p>cinder配置文件/etc/cinder/cinder.conf</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf DEFAULT rpc_backend rabbit</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf DEFAULT auth_strategy keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf DEFAULT my_ip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.128</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf DEFAULT transport_url  rabbit://openstack:Abc-1234@ctl01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf database connection mysql+pymysql://cinder:Abc-1234@ctl01/cinder</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf oslo_messaging_rabbit rabbit_hosts ctl01:5672</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf oslo_messaging_rabbit rabbit_userid openstack</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf oslo_messaging_rabbit rabbit_password 'Abc-1234'</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf keystone_authtoken auth_url http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf keystone_authtoken www_authenticate_uri http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf keystone_authtoken memcached_servers ctl01:11211</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf keystone_authtoken auth_type password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf keystone_authtoken project_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf keystone_authtoken user_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf keystone_authtoken project_name service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf keystone_authtoken username cinder</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf keystone_authtoken password 'Abc-1234'</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf oslo_concurrency lock_path /var/lib/cinder/tmp</span></span></code></pre></figure>
<p>初始化块设备服务的数据库：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">su</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh -c &quot;cinder-manage db sync&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cinder</span></span></code></pre></figure>
<p>配置计算服务以使用块设备存储</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nova/nova.conf cinder os_region_name RegionOne</span></span></code></pre></figure>
<p>重启nova计算和cinder块存储服务并设置开机自启动</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-nova-api.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-cinder-api.service openstack-cinder-scheduler.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable openstack-cinder-api.service openstack-cinder-scheduler.service</span></span></code></pre></figure>
<h4 id="存储节点配置">存储节点配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#存储节点配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>在控制节点（cinder01：10.191.101.131）上配置</p>
<p>安装LVM软件包</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install -y lvm2 device-mapper-persistent-data</span></span></code></pre></figure>
<p>启动LVM元数据服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable lvm2-lvmetad.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart lvm2-lvmetad.service</span></span></code></pre></figure>
<p>添加一块100G硬盘，重启节点后创建LVM物理卷/dev/sdb</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pvcreate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/sdb</span></span></code></pre></figure>
<p>创建LVM物理卷</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vgcreate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cinder-volumes /dev/sdb</span></span></code></pre></figure>
<p>编辑配置文件/etc/lvm/lvm.conf,在devices部分，添加一个过滤器，只接受/dev/sdb设备，拒绝其他所有设备</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/lvm/lvm.conf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">devices</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = [ &quot;a/sdb/&quot;, &quot;r/.*/&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ]</span></span></code></pre></figure>
<p>安装train版yum源和cinder软件包</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install centos-release-openstack-train</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install openstack-cinder targetcli python-keystone openstack-utils</span></span></code></pre></figure>
<p>编辑配置文件/etc/cinder/cinder.conf</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf /etc/cinder/cinder.conf.bak</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -Ev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> '#|^$'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf.ba</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/cinder/cinder.conf</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">my_ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.131</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  database  connection mysql+pymysql://cinder:Abc-1234@ctl01/cinder</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  DEFAULT transport_url rabbit://openstack:Abc-1234@ctl01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  DEFAULT auth_strategy keystone</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  DEFAULT my_ip &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$my_ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  DEFAULT enabled_backends lvm</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  DEFAULT glance_api_servers http://ctl01:9292</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  keystone_authtoken www_authenticate_uri http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  keystone_authtoken auth_url http://ctl01:5000</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  keystone_authtoken memcached_servers ctl01:11211</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  keystone_authtoken auth_type password</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  keystone_authtoken project_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  keystone_authtoken user_domain_name default</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  keystone_authtoken project_name service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  keystone_authtoken username cinder</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  keystone_authtoken password Abc-1234</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  lvm volume_driver cinder.volume.drivers.lvm.LVMVolumeDriver</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  lvm volume_group cinder-volumes</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  lvm target_protocol iscsi</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  lvm target_helper lioadm</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack-config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf  oslo_concurrency lock_path /var/lib/cinder/tmp</span></span></code></pre></figure>
<p>启动块存储卷服务并设置开机自启动</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-cinder-volume.service target.service</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable openstack-cinder-volume.service target.service</span></span></code></pre></figure>
<p>在控制节点验证服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume service list</span></span></code></pre></figure>
<p>在dashboard查看
<img src="../云计算和虚拟化/attachments/Pasted-image-20240114225823.png" width="auto" height="auto" alt/></p>
<p>创建卷测试
<img src="../云计算和虚拟化/attachments/Pasted-image-20240114225838.png" width="auto" height="auto" alt/></p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114225852.png" width="auto" height="auto" alt/></p>
<h1 id="openstack使用"><strong>Openstack使用</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#openstack使用" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p>从cirros镜像创建卷测试创建虚拟机
<img src="../云计算和虚拟化/attachments/Pasted-image-20240114225916.png" width="auto" height="auto" alt/></p>
<p>创建实例类型
<img src="../云计算和虚拟化/attachments/Pasted-image-20240114225929.png" width="auto" height="auto" alt/></p>
<h2 id="建立公共提供商网络"><strong>建立公共提供商网络</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#建立公共提供商网络" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="创建网络"><strong>创建网络</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#创建网络" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>在admin管理员下创建</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network create --share --external --provider-physical-network provider --provider-network-type flat provider</span></span></code></pre></figure>
<p>参数理解：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--share</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 允许所有项目使用虚拟网络</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--external</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 将虚拟网络定义为外部,如果想创建一个内部网络，则可以使用--internal。默认值为internal</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--provider-physical-network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> provider</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指明物理网络的提供者，provider 与下面neutron的配置文件对应，其中provider是标签，可以更改为其他，但是2个地方必须要统一</span></span>
<span data-line> </span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置文件/etc/neutron/plugins/ml2/ml2_conf.ini中的参数</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ml2_type_flat]</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flat_networks</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = provider</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[linux_bridge]</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">physical_interface_mappings</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = provider:ens33</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--provider-network-type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> flat 指明这里创建的网络是flat类型，即实例连接到此网络时和物理网络是在同一个网段，无vlan等功能。</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">最后输入的provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 指定网络的名称</span></span>
<span data-line> </span></code></pre></figure>
<h3 id="创建子网"><strong>创建子网</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#创建子网" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>在网络上创建一个子网 10.191.101.0/24 ; 子网对应真实的物理网络</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> subnet create --network provider </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --allocation-pool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.10,end=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.20 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --dns-nameserver</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.2 --gateway </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.2 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --subnet-range</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.0/24 provider</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 参数解释:</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--network</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> provider 指定父网络</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--allocation-pool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.10,end=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.20 指定子网的起始地址和终止地址</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--dns-nameserver</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.2 指定DNS服务器地址</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--gateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.2 指定网关地址</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--subnet-range</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.0/24 指定子网的网段</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">最后的provider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 指定子网的名称</span></span></code></pre></figure>
<p>创建实例</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114225946.png" width="auto" height="auto" alt/></p>
<p>测试网络
<img src="../云计算和虚拟化/attachments/Pasted-image-20240114230001.png" width="auto" height="auto" alt/></p>
<h2 id="建立普通租户的私有自助服务网络"><strong>建立普通租户的私有自助服务网络</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#建立普通租户的私有自助服务网络" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="创建网络-1"><strong>创建网络</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#创建网络-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>自助服务网络，也叫租户网络或项目网络，它是由openstack租户创建的，完全虚拟的，是租户私有的，只在本网络内部连通，不能在租户之间共享</p>
<p>在普通租户下创建网络，当前使用账号myuser，重置密码为Abc-1234</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114230131.png" width="auto" height="auto" alt/></p>
<p>非特权用户通常无法为该命令提供其他参数，该服务使用以下配置文件中的信息自动选择参数</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/neutron/plugins/ml2/ml2_conf.ini</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ml2]</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">type_drivers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = flat,vlan,vxlan</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tenant_network_types</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = vxlan</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ml2_type_vxlan]</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vni_ranges</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:1000</span></span></code></pre></figure>
<h3 id="创建子网-1"><strong>创建子网</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#创建子网-1" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>创建一个子网 172.18.1.0/24</p>
<p><img src="../云计算和虚拟化/attachments/Pasted-image-20240114230157.png" width="auto" height="auto" alt/></p>
<h3 id="创建路由"><strong>创建路由</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#创建路由" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>使用命令创建，配置myuser环境变量</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myuser-openrc</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_USERNAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">myuser</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Abc-1234</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_PROJECT_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">myproject</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_USER_DOMAIN_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Default</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_PROJECT_DOMAIN_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Default</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_AUTH_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://ctl01:5000/v3</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_IDENTITY_API_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span></code></pre></figure>
<p>查看已创建的网络</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network list</span></span></code></pre></figure>
<p>查看已创建的子网</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> subnet list</span></span></code></pre></figure>
<p>创建路由器，用myuser普通租户创建</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/myuser-openrc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> router create router01</span></span></code></pre></figure>
<p>查看创建的路由</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> router list</span></span></code></pre></figure>
<p>将创建的租户自助服务网络子网添加为路由器上的接口</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> router add subnet router01 selfservice</span></span></code></pre></figure>
<p>在路由器的公共提供商网络上设置网关</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> router set router01 --external-gateway provider</span></span></code></pre></figure>
<h3 id="ip-nets"><strong>Ip nets</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ip-nets" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ctl01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ip netns</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qrouter-7962017d-fd01-4863-aae0-329fd704bc78</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qdhcp-28e70282-9aff-4048-8e17-9a2879f9eab2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用ip netns命令找到这个虚拟路由器之后，用这个虚拟路由器ping真实物理网络中的网关，ping通即证明OpenStack内部虚拟网络与真实物理网络衔接成功</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ctl01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ip netns</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qrouter-7962017d-fd01-4863-aae0-329fd704bc78</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">qdhcp-28e70282-9aff-4048-8e17-9a2879f9eab2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ctl01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ip netns exec qrouter-7962017d-fd01-4863-aae0-329fd704bc78 ping 10.191.101.2</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PING</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.2 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.191.101.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">56</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">84</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bytes of data.</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes from </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.2: icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.663</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes from </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.191</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.101.2: icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.235</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span></span></code></pre></figure>
<p>验证查看创建网络和子网中的IP地址范围，回到admin用户下</p>
<p>列出路由器上的端口，以确定提供商网络上的网关IP地址</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port list --router router01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+--------------------------------------+------+-------------------+------------------------------------------------------------------------------+--------+</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MAC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Address       </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Fixed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> IP Addresses                                                           </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+--------------------------------------+------+-------------------+------------------------------------------------------------------------------+--------+</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2cfa2e4b-3b57-4aa3-af77-59eca94242eb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fa:16:3e:56:7f:9a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ip_address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'172.18.1.1', subnet_id='1213f505-8e0d-4b5e-b7b9-f659aaf92486'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ACTIVE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> be99fadb-47fd-4247-b504-baf00d810f8d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fa:16:3e:8e:1a:4d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ip_address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'10.191.101.13', subnet_id='4f7508fd-b250-44b8-be9c-f2d840abd852'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ACTIVE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+--------------------------------------+------+-------------------+------------------------------------------------------------------------------+--------+</span></span></code></pre></figure>
<h1 id="ceph安装"><strong>Ceph安装</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ceph安装" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p>节点规划：单节点</p>



















<div class="table-container"><table><thead><tr><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>ceph01（可选）</td><td>ceph单节点</td><td>10.191.101.140/24</td><td>192.168.80.140/24</td><td>1C2G</td></tr></tbody></table></div>
<p>系统版本</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/redhat-release</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CentOS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Linux release </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7.6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.1810 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Core</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></figure>
<p>自动补全</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install -y bash-completion</span></span></code></pre></figure>
<p>主机名</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname ceph01</span></span></code></pre></figure>
<p>Yum配置</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/yum.repos.d/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -rf</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://mirrors.aliyun.com/repo/Centos-7.repo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/yum.repos.d/Centos-7.repo</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://mirrors.aliyun.com/repo/epel-7.repo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/yum.repos.d/epel.repo</span></span></code></pre></figure>
<p>Ceph yum源</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  /etc/yum.repos.d/ceph.repo</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Ceph]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ceph packages for </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$basearch</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">baseurl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://download.ceph.com/rpm-mimic/el7/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$basearch</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpgcheck</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rpm-md</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpgkey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://download.ceph.com/keys/release.asc</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">priority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Ceph-noarch]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ceph noarch packages</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">baseurl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://download.ceph.com/rpm-mimic/el7/noarch</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpgcheck</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rpm-md</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpgkey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://download.ceph.com/keys/release.asc</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">priority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ceph-source]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Ceph source packages</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">baseurl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://download.ceph.com/rpm-mimic/el7/SRPMS</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpgcheck</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rpm-md</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gpgkey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://download.ceph.com/keys/release.asc</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">priority</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span></code></pre></figure>
<p>Hosts配置（对接openstack，同步添加openstack节点）</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hostnamectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set-hostname ceph01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/hosts </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;&lt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">‘EOF’</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.191.101.140</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOSTNAME</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.191.101.128</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ctl01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.191.101.129</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compute01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.191.101.130</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> neutron01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.191.101.131</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cinder01</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EOF</span></span></code></pre></figure>
<p>关闭selinux和防火墙</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setenforce</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 's/SELINUX=.*/SELINUX=disabled/'</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/selinux/config</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop firewalld</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable firewalld</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mask firewalld</span></span></code></pre></figure>
<p>安装软件</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clean all </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> makecache</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install ceph-deploy epel-release python-pip ceph ceph-radosgw chrony   </span></span></code></pre></figure>
<p>部署ceph集群</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ceph/</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph-deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOSTNAME</span></span></code></pre></figure>
<p>单节点配置需要修改配置</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> >></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/ceph/ceph.conf </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> EOF</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">osd pool default size = 1</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">osd crush chooseleaf type = 0</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">osd max object name len = 256</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">osd journal size = 128</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">EOF</span></span></code></pre></figure>
<p>安装ceph节点</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CEPH_DEPLOY_REPO_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://mirrors.aliyun.com/ceph/rpm-nautilus/el7/</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CEPH_DEPLOY_GPG_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">http://mirrors.aliyun.com/ceph/keys/release.asc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph-deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOSTNAME</span></span></code></pre></figure>
<p>查看版本</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span></span></code></pre></figure>
<p>使用ceph-deploy进行部署，在更新的版本中，该工具已被弃用
初始化监视节点和同步所有配置文件到 /etc/ceph/ 下</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph-deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mon create-initial</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph-deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOSTNAME</span></span></code></pre></figure>
<p>节点下创建manager</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph-deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mgr create </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOSTNAME</span></span></code></pre></figure>
<p>添加osd</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph-deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd create --data /dev/sdX </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOSTNAME</span></span></code></pre></figure>
<p>部署完成，检查单节点ceph部署情况</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span></span></code></pre></figure>
<h3 id="dashboard配置">Dashboard配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#dashboard配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>在每个mgr节点安装</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install ceph-mgr-dashboard</span></span></code></pre></figure>
<p>开启mgr功能</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mgr module enable dashboard</span></span></code></pre></figure>
<p>生成并安装自签名的证书</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dashboard create-self-signed-cert</span></span></code></pre></figure>
<p>创建一个dashboard登录用户名密码</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 密码写入文件中，命令行从文件中读入密码</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ceph01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ceph dashboard ac-user-create guest -i ceph-passwd.txt  administrator</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;username&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;guest&quot;, &quot;lastUpdate&quot;: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1702966284</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, &quot;name&quot;: null, &quot;roles&quot;: [&quot;administrator&quot;], &quot;password&quot;: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$2b$12$qKgRIUT1xz41kJjeUqsQm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.h.ktyN.QA4981Kw5OUoY1Ea.uCuRAA2&quot;, &quot;email&quot;: null}</span></span></code></pre></figure>
<p>查看服务访问方式</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ceph01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ceph mgr services</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;dashboard&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://ceph01:8443/&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 若未配置域名解析则通过ip访问</span></span></code></pre></figure>
<h3 id="ceph常用命令">Ceph常用命令<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ceph常用命令" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<h4 id="osd维护命令">OSD维护命令<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#osd维护命令" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示Ceph集群中的OSD树，包括每个OSD的状态和位置</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd tree</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示Ceph集群中的OSD状态摘要信息</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd stat</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示Ceph集群中的所有pool</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd pool ls</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示pool中详细的volume信息</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rbd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --pool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pool_nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将指定的OSD标记为“离线”，从集群中排除</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd out </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">osd-i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将指定的OSD标记为“在线”，重新加入集群</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd in </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">osd-i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 为存储池设置副本大小</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd pool set </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pool_nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">replica_siz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span></span></code></pre></figure>
<h4 id="monitor维护命令">Monitor维护命令<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#monitor维护命令" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示Ceph集群中监视器的状态信息</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mon stat</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示Ceph集群中监视器的详细信息</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mon dump</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从Ceph集群中移除指定的监视器</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mon remove </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mon-i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span></span></code></pre></figure>
<h4 id="pg维护命令">PG维护命令<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#pg维护命令" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<pre><code># 显示Ceph集群中PG（placement group）的状态信息
ceph pg stat

# 修复指定的PG，解决可能的一致性问题
ceph pg repair &lt;pg-id>

# 对指定的PG执行“scrub”操作，检查和修复数据
ceph pg scrub &lt;pg-id>
</code></pre>
<h4 id="健康状态命令">健康状态命令<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#健康状态命令" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<pre><code># 检查Ceph集群的健康状态
ceph health

# 显示详细的Ceph集群健康状态信息
ceph health detail

# 运行指定的健康检查
ceph health check &lt;check-name>
</code></pre>
<h4 id="管理ceph配置文件">管理Ceph配置文件<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#管理ceph配置文件" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<pre><code># 显示Ceph集群的配置信息
ceph config show

# 设置指定的Ceph配置项
ceph config set &lt;key> &lt;value>

# 获取指定的Ceph配置项的值
ceph config get &lt;key>
</code></pre>
<h3 id="常见告警处理">常见告警处理<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#常见告警处理" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>1 monitors have not enabled msgr2</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mon enable-msgr2</span></span></code></pre></figure>
<blockquote>
<p>msgr2是Ceph的新消息传输协议，它提供了更好的性能和安全性</p>
</blockquote>
<p>mon is allowing insecure global_id reclaim</p>
<pre><code># 禁用不安全模式
 ceph config set mon auth_allow_insecure_global_id_reclaim false
</code></pre>
<blockquote>
<p>这个警告表示Ceph监视器正在允许不安全的全局ID回收。全局ID是Ceph集群中的唯一标识符，用于识别对象和其他元数据。不安全的全局ID回收可能会导致ID冲突和数据不一致的问题</p>
</blockquote>
<h3 id="对接openstack">对接OpenStack<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#对接openstack" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<blockquote>
<p>通常，OpenStack有3个地方可以和Ceph存储进行对接：
1、Images：OpenStack 的 Glance 管理着 VM 的 image 。Image 相对恒定，OpenStack 把它们当作二进制文件、并以此格式下载；
2、Volumes：OpenStack 用 Cinder 服务管理 Volumes 。Volume 是块设备，OpenStack 用它们引导虚拟机、或挂载到运行中的虚拟机上；
3、Guest Disks: Guest disks 是装有客户操作系统的磁盘。默认情况下，启动一台虚拟机时，它的系统盘表现为 hypervisor 文件系统的一个文件（通常位于 /var/lib/nova/instances/${uuid}/）；</p>
</blockquote>
<p>安装ini配置工具</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install crudini </span></span></code></pre></figure>
<p>在glance-api的主机上安装python-rbd包</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install python-rbd</span></span></code></pre></figure>
<p>在nova-compute（所有计算节点）、cinder-volume节点上安装ceph-common包</p>
<ul>
<li>在控制节点运行命令检查对应服务所在的节点</li>
</ul>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume service list</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+------------------+--------------+------+---------+-------+----------------------------+</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Binary</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Zone</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Updated</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> At                 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+------------------+--------------+------+---------+-------+----------------------------+</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cinder-scheduler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ctl01</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nova</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> up</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2023-12-19T08:03:42.000000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cinder-volume</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cinder01@lvm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nova</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> up</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> 2023-12-19T08:03:42.000000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+------------------+--------------+------+---------+-------+----------------------------+</span></span></code></pre></figure>
<ul>
<li>在对应节点执行安装</li>
</ul>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install ceph-common</span></span></code></pre></figure>
<p>把ceph集群的/etc/ceph/ceph.conf 、/etc/ceph/ceph.client.admin.keyring 文件拷贝到以上openstack各节点的/etc/ceph目录下，确保以上openstack各对应节点成为ceph集群的客户端</p>
<p>在ceph集群创建三个pool ，分别对应上文三个模块。以后所有的OpenStack虚拟机数据都会存储到这三个池中。</p>
<p>创建volumes池，对应Cinder服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd pool create os_volumes </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span></code></pre></figure>
<p>创建images池，对应Glance服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd pool create os_images </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span></code></pre></figure>
<p>创建vms池，对应Nova服务</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> osd pool create os_vms </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span></code></pre></figure>
<p>设置存储池副本数量</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ceph01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ceph osd pool set os_vms size 1</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pool </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> size to </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ceph01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ceph osd pool set os_images size 1</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pool </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> size to </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ceph01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ceph osd pool set os_volumes size 2</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pool </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> size to </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span></code></pre></figure>
<p>在ceph集群创建cinder、glance等用户，并做权限控制</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ceph01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ceph auth get-or-create client.cinder mon </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'allow r'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> osd </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'allow class-read object_prefix rbd_children, allow rwx pool=os_volumes, allow rwx pool=os_vms, allow rx pool=os_images'</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[client.cinder]</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = AQAMVYFl0ExWCxAAT632K3WB+5VtaXh3bp8DzA==</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@ceph01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ceph auth get-or-create client.glance mon </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'allow r'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> osd </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'allow class-read object_prefix rbd_children, allow rwx pool=os_images'</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[client.glance]</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> = AQAPVYFlceRZBBAA/V5Cg7SEC6TUZo543/H0tQ==</span></span>
<span data-line> </span></code></pre></figure>
<p>（在ceph端执行）将上面生成的keyring文件，保存在glance和volume节点上，并修改为相应的权限</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auth get-or-create client.glance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ctl01 sudo tee /etc/ceph/ceph.client.glance.keyring</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ctl01 sudo chown glance:glance /etc/ceph/ceph.client.glance.keyring</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auth get-or-create client.cinder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cinder01 sudo tee /etc/ceph/ceph.client.cinder.keyring</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cinder01 sudo chown cinder:cinder /etc/ceph/ceph.client.cinder.keyring</span></span></code></pre></figure>
<p>在nova-compute节点（所有计算节点）上保存和cinder-volume相同的keyring</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auth get-or-create client.cinder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compute01 sudo tee /etc/ceph/ceph.client.cinder.keyring</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compute01 sudo chown nova:nova /etc/ceph/ceph.client.cinder.keyring</span></span></code></pre></figure>
<h4 id="compute-节点配置">compute 节点配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#compute-节点配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>在openstack集群所有compute节点libvirt上添加secret key</p>
<ul>
<li>从ceph集群获取cinder keyring，并保存到nova-comute对应节点/root目录下一个临时文件中</li>
</ul>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ceph</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> auth get-key client.cinder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ssh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compute01 tee client.cinder.key </span></span></code></pre></figure>
<blockquote>
<p>执行完后nova-compute节点的/root下会出现临时的文件</p>
</blockquote>
<ul>
<li>在compute节点生成一个UUID</li>
</ul>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uuidgen</span></span></code></pre></figure>
<p>比如生成：912f054c-478b-44b7-bfc5-f0bbed491fbb</p>
<ul>
<li>/root下touch一个文件 secret.xml 内容如下：</li>
</ul>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="xml" data-theme="github-light github-dark"><code data-language="xml" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">secret</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ephemeral</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'no'</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'no'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>912f054c-478b-44b7-bfc5-f0bbed491fbb&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">usage</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'ceph'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>client.cinder secret&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">usage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">secret</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">></span></span></code></pre></figure>
<p>通过libvirt工具（virsh）定义和设置秘钥，并在设置秘钥值后删除相关的秘钥和XML文件</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@compute01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# virsh secret-define --file secret.xml</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Secret</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 912</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">f054c-478b-44b7-bfc5-f0bbed491fbb created</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@compute01 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# virsh secret-set-value --secret 912f054c-478b-44b7-bfc5-f0bbed491fbb --base64 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client.cinder.key)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client.cinder.key secret.xml</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value set</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove regular file ‘client.cinder.key’? y</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove regular file ‘secret.xml’? y</span></span></code></pre></figure>
<p>配置nova-compute节点/etc/nova/nova.conf中添加如下：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="ini" data-theme="github-light github-dark"><code data-language="ini" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[libvirt]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">images_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = rbd</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">images_rbd_pool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = os_vms</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">images_rbd_ceph_conf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = /etc/ceph/ceph.conf</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rbd_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = cinder</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rbd_secret_uuid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 912f054c-478b-44b7-bfc5-f0bbed491fbb</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">disk_cachemodes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;network=writeback&quot;</span></span></code></pre></figure>
<p>对应节点重启服务：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-nova-compute </span></span></code></pre></figure>
<h4 id="glance-节点配置">glance 节点配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#glance-节点配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>配置glance节点/etc/glance/glance-api.conf对接ceph</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf DEFAULT &quot;show_image_direct_url&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;True&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf glance_store &quot;default_store&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;rbd&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf glance_store &quot;rbd_store_user&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;glance&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf glance_store &quot;rbd_store_pool&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;os_images&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf glance_store &quot;stores&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;glance.store.filesystem.Store, glance.store.http.Store, glance.store.rbd.Store&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf paste_deploy &quot;flavor&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;keystone&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf glance_store &quot;rbd_store_chunk_size&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;8&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/glance/glance-api.conf glance_store &quot;rbd_store_ceph_conf&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/etc/ceph/ceph.conf&quot;</span></span></code></pre></figure>
<p>在DEFAULT域中增加：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="ini" data-theme="github-light github-dark"><code data-language="ini" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[DEFAULT]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">default_store</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = rbd</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认是file，要修改</span></span></code></pre></figure>
<p>在glance_store域中增加如下，如果没有glance_store域，直接创建：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="ini" data-theme="github-light github-dark"><code data-language="ini" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[glance_store]</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">stores</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = rbd</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rbd_store_pool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = os_images</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rbd_store_user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = glance</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rbd_store_ceph_conf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = /etc/ceph/ceph.conf</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rbd_store_chunk_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 8</span></span></code></pre></figure>
<p>对应节点重启服务：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-glance-api </span></span></code></pre></figure>
<h4 id="cinder-节点配置">cinder 节点配置<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#cinder-节点配置" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>配置cinder节点的/etc/cinder/cinder.conf对接ceph</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf DEFAULT &quot;enabled_backends&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;lvm,ceph&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 同时支持lvm、ceph</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;volume_driver&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;cinder.volume.drivers.rbd.RBDDriver&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;volume_backend_name&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ceph&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;rbd_pool&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;os_volumes&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;rbd_ceph_conf&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/etc/ceph/ceph.conf&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;rbd_flatten_volume_from_snapshot&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;false&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;rbd_max_clone_depth&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;5&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;rbd_store_chunk_size&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;4&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;rados_connect_timeout&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;-1&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;glance_api_version&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;2&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;rbd_user&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;cinder&quot;</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crudini</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/cinder/cinder.conf ceph &quot;rbd_secret_uuid&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;912f054c-478b-44b7-bfc5-f0bbed491fbb&quot;</span></span></code></pre></figure>
<p>对应节点重启服务：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart openstack-cinder-volume </span></span></code></pre></figure>
<h4 id="验证-2">验证<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#验证-2" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<p>openstack的dashboard中测试创建卷、生成镜像和卷生成虚拟机等操作</p>
<p>查看 volume service</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume service list</span></span></code></pre></figure>
<p>创建 volume type</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openstack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume type create lvm</span></span></code></pre></figure></article></div><div class="right sidebar"><div class="graph"><h3>关系图谱</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc" class><h3>目录</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-1"><a href="#基础环境准备" data-for="基础环境准备">基础环境准备</a></li><li class="depth-2"><a href="#节点规划" data-for="节点规划">节点规划</a></li><li class="depth-2"><a href="#系统版本" data-for="系统版本">系统版本</a></li><li class="depth-2"><a href="#自动补全" data-for="自动补全">自动补全</a></li><li class="depth-2"><a href="#下载包到本地" data-for="下载包到本地">下载包到本地</a></li><li class="depth-2"><a href="#配置本地yum" data-for="配置本地yum">配置本地YUM</a></li><li class="depth-2"><a href="#基础工具安装" data-for="基础工具安装">基础工具安装</a></li><li class="depth-2"><a href="#更改主机名" data-for="更改主机名">更改主机名</a></li><li class="depth-2"><a href="#配置网络" data-for="配置网络">配置网络</a></li><li class="depth-2"><a href="#关闭selinux" data-for="关闭selinux">关闭selinux</a></li><li class="depth-2"><a href="#连接数配置" data-for="连接数配置">连接数配置</a></li><li class="depth-2"><a href="#关闭防火墙" data-for="关闭防火墙">关闭防火墙</a></li><li class="depth-2"><a href="#关闭networkmanager" data-for="关闭networkmanager">关闭NetworkManager</a></li><li class="depth-2"><a href="#hosts文件配置" data-for="hosts文件配置">HOSTS文件配置</a></li><li class="depth-2"><a href="#ntp时钟同步" data-for="ntp时钟同步">NTP时钟同步</a></li><li class="depth-1"><a href="#数据库" data-for="数据库">数据库</a></li><li class="depth-1"><a href="#消息队列" data-for="消息队列">消息队列</a></li><li class="depth-1"><a href="#memcached" data-for="memcached">Memcached</a></li><li class="depth-1"><a href="#etcd" data-for="etcd">Etcd</a></li><li class="depth-1"><a href="#密码规划" data-for="密码规划">密码规划</a></li><li class="depth-1"><a href="#minimal-deployment-for-train" data-for="minimal-deployment-for-train">Minimal deployment for Train</a></li><li class="depth-2"><a href="#keystone" data-for="keystone">Keystone</a></li><li class="depth-2"><a href="#glance" data-for="glance">Glance</a></li><li class="depth-2"><a href="#placement" data-for="placement">Placement</a></li><li class="depth-2"><a href="#nova" data-for="nova">Nova</a></li><li class="depth-2"><a href="#neutron" data-for="neutron">Neutron</a></li><li class="depth-2"><a href="#horizon" data-for="horizon">Horizon</a></li><li class="depth-2"><a href="#cinder" data-for="cinder">Cinder</a></li><li class="depth-0"><a href="#openstack使用" data-for="openstack使用">Openstack使用</a></li><li class="depth-1"><a href="#建立公共提供商网络" data-for="建立公共提供商网络">建立公共提供商网络</a></li><li class="depth-2"><a href="#创建网络" data-for="创建网络">创建网络</a></li><li class="depth-2"><a href="#创建子网" data-for="创建子网">创建子网</a></li><li class="depth-1"><a href="#建立普通租户的私有自助服务网络" data-for="建立普通租户的私有自助服务网络">建立普通租户的私有自助服务网络</a></li><li class="depth-2"><a href="#创建网络-1" data-for="创建网络-1">创建网络</a></li><li class="depth-2"><a href="#创建子网-1" data-for="创建子网-1">创建子网</a></li><li class="depth-2"><a href="#创建路由" data-for="创建路由">创建路由</a></li><li class="depth-2"><a href="#ip-nets" data-for="ip-nets">Ip nets</a></li><li class="depth-0"><a href="#ceph安装" data-for="ceph安装">Ceph安装</a></li><li class="depth-2"><a href="#dashboard配置" data-for="dashboard配置">Dashboard配置</a></li><li class="depth-2"><a href="#ceph常用命令" data-for="ceph常用命令">Ceph常用命令</a></li><li class="depth-2"><a href="#常见告警处理" data-for="常见告警处理">常见告警处理</a></li><li class="depth-2"><a href="#对接openstack" data-for="对接openstack">对接OpenStack</a></li></ul></div></div><div class="backlinks"><h3>反向链接</h3><ul class="overflow"><li>无法找到反向链接</li></ul></div></div></div><footer class><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.2.2</a> © 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></body><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="../postscript.js" type="module"></script></html>