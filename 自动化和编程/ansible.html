<!DOCTYPE html>
<html lang="zh"><head><title>ansible</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="ansible"/><meta property="og:description" content="简介 基于Python开源的自动化工具，用于配置管理、部署、编排和远程执行任务，它使用SSH协议进行通信，由Paramiko（Python库）、 PyYAML和Jinja2 ( 模板化 ) 三个关键模块实现，并使用基于YAML的描述文件来定义任务和配置 特性 模块化 无客户端 主从模式 幂等性 关键参数 主机清单（Inventory）：主机清单是一个YAML或INI格式的文件，用于定义受管理的主机和主机组，它指定了Ansible将在哪些主机上执行任务 模块（Module）：模块是Ansible的基本执行单元，用于在目标主机上执行特定的任务，Ansible提供了丰富的模块库，包括文件操作、软件包管理、用户管理等各种功能 Playbook（剧本）：Playbook是一个YAML格式的文件，用于定义一系列任务和配置的顺序，它描述了Ansible在目标主机上执行的操作流程，包括主机选择、任务执行和变量设置等 角色（Role）：角色是一种组织和复用任务和配置的方法，它将相关的任务、变量和文件组织在一起，以便在多个Playbook中重复使用 变量（Variable）：变量用于存储和传递数据，在Playbook中可以使用变量来实现灵活的配置，变量可以在主机清单、Playbook和角色中定义，并可以通过模板或命令行参数进行动态设置 Handlers：Handlers是一种特殊的任务，它用于响应其他任务的状态变化，当某个任务发生变化时，Handlers可以触发相应的操作，如重新启动服务、重新加载配置等 模板（Template）：模板是一种用于生成配置文件的机制，Ansible使用jinja2模板引擎，可以在模板中使用变量和条件语句来动态生成配置文件 Vault：Vault用于安全地存储敏感信息，如密码和密钥，它可以加密和解密Ansible的变量文件，以防止敏感信息泄露 开始 [root@localhost ~]# ansible localhost -m command -a &amp;#039;echo hello world!&amp;#039; localhost | CHANGED | rc=0 &amp;gt;&amp;gt; hello world! Ad-Hoc command 简短地指令，指令操作模式 [root@localhost ansible]# ansible local -m ping 10."/><meta property="og:image" content="https://chyuhung.github.io/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="简介 基于Python开源的自动化工具，用于配置管理、部署、编排和远程执行任务，它使用SSH协议进行通信，由Paramiko（Python库）、 PyYAML和Jinja2 ( 模板化 ) 三个关键模块实现，并使用基于YAML的描述文件来定义任务和配置 特性 模块化 无客户端 主从模式 幂等性 关键参数 主机清单（Inventory）：主机清单是一个YAML或INI格式的文件，用于定义受管理的主机和主机组，它指定了Ansible将在哪些主机上执行任务 模块（Module）：模块是Ansible的基本执行单元，用于在目标主机上执行特定的任务，Ansible提供了丰富的模块库，包括文件操作、软件包管理、用户管理等各种功能 Playbook（剧本）：Playbook是一个YAML格式的文件，用于定义一系列任务和配置的顺序，它描述了Ansible在目标主机上执行的操作流程，包括主机选择、任务执行和变量设置等 角色（Role）：角色是一种组织和复用任务和配置的方法，它将相关的任务、变量和文件组织在一起，以便在多个Playbook中重复使用 变量（Variable）：变量用于存储和传递数据，在Playbook中可以使用变量来实现灵活的配置，变量可以在主机清单、Playbook和角色中定义，并可以通过模板或命令行参数进行动态设置 Handlers：Handlers是一种特殊的任务，它用于响应其他任务的状态变化，当某个任务发生变化时，Handlers可以触发相应的操作，如重新启动服务、重新加载配置等 模板（Template）：模板是一种用于生成配置文件的机制，Ansible使用jinja2模板引擎，可以在模板中使用变量和条件语句来动态生成配置文件 Vault：Vault用于安全地存储敏感信息，如密码和密钥，它可以加密和解密Ansible的变量文件，以防止敏感信息泄露 开始 [root@localhost ~]# ansible localhost -m command -a &amp;#039;echo hello world!&amp;#039; localhost | CHANGED | rc=0 &amp;gt;&amp;gt; hello world! Ad-Hoc command 简短地指令，指令操作模式 [root@localhost ansible]# ansible local -m ping 10."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="自动化和编程/ansible"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="..">🪴 十二万光年</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>搜索</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="搜索些什么" placeholder="搜索些什么"/><div id="search-layout" data-preview="true"></div></div></div></div><div class="darkmode"><input class="toggle" id="darkmode-toggle" type="checkbox" tabindex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve"><title>暗色模式</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve"><title>亮色模式</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;云计算和虚拟化&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;基础技能&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;安全和权限管理&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;应用部署和容灾&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;故障排除和性能优化&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;文档和沟通能力&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;监控和日志管理&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;网络和存储管理&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;自动化和编程&quot;,&quot;collapsed&quot;:true}]"><h1>探索</h1><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-outer "><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="云计算和虚拟化"><button class="folder-button"><span class="folder-title">云计算和虚拟化</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="云计算和虚拟化"><li><a href="../云计算和虚拟化/k8s" data-for="云计算和虚拟化/k8s">k8s</a></li><li><a href="../云计算和虚拟化/openstack" data-for="云计算和虚拟化/openstack">openstack</a></li><li><a href="../云计算和虚拟化/云计算和虚拟化" data-for="云计算和虚拟化/云计算和虚拟化">云计算和虚拟化</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="基础技能"><button class="folder-button"><span class="folder-title">基础技能</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="基础技能"><li><a href="../基础技能/go" data-for="基础技能/go">go</a></li><li><a href="../基础技能/python" data-for="基础技能/python">python</a></li><li><a href="../基础技能/shell" data-for="基础技能/shell">shell</a></li><li><a href="../基础技能/vue" data-for="基础技能/vue">vue</a></li><li><a href="../基础技能/基础技能" data-for="基础技能/基础技能">基础技能</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="安全和权限管理"><button class="folder-button"><span class="folder-title">安全和权限管理</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="安全和权限管理"><li><a href="../安全和权限管理/ssh免密登录" data-for="安全和权限管理/ssh免密登录">ssh免密登录</a></li><li><a href="../安全和权限管理/公钥与私钥" data-for="安全和权限管理/公钥与私钥">公钥与私钥</a></li><li><a href="../安全和权限管理/安全和权限管理" data-for="安全和权限管理/安全和权限管理">安全和权限管理</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="应用部署和容灾"><button class="folder-button"><span class="folder-title">应用部署和容灾</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="应用部署和容灾"><li><a href="../应用部署和容灾/应用部署和容灾" data-for="应用部署和容灾/应用部署和容灾">应用部署和容灾</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="故障排除和性能优化"><button class="folder-button"><span class="folder-title">故障排除和性能优化</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="故障排除和性能优化"><li><a href="../故障排除和性能优化/linux-出错-task-xxxxx-634-blocked-for-more-than-120-seconds" data-for="故障排除和性能优化/linux-出错-task-xxxxx-634-blocked-for-more-than-120-seconds">linux 出错 task xxxxx 634 blocked for more than 120 seconds</a></li><li><a href="../故障排除和性能优化/mysql" data-for="故障排除和性能优化/mysql">mysql</a></li><li><a href="../故障排除和性能优化/故障排除和性能优化" data-for="故障排除和性能优化/故障排除和性能优化">故障排除和性能优化</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="文档和沟通能力"><button class="folder-button"><span class="folder-title">文档和沟通能力</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="文档和沟通能力"><li><a href="../文档和沟通能力/文档和沟通能力" data-for="文档和沟通能力/文档和沟通能力">文档和沟通能力</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="监控和日志管理"><button class="folder-button"><span class="folder-title">监控和日志管理</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="监控和日志管理"><li><a href="../监控和日志管理/监控和日志管理" data-for="监控和日志管理/监控和日志管理">监控和日志管理</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="网络和存储管理"><button class="folder-button"><span class="folder-title">网络和存储管理</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="网络和存储管理"><li><a href="../网络和存储管理/ceph" data-for="网络和存储管理/ceph">ceph</a></li><li><a href="../网络和存储管理/keepalived" data-for="网络和存储管理/keepalived">keepalived</a></li><li><a href="../网络和存储管理/mysql" data-for="网络和存储管理/mysql">mysql</a></li><li><a href="../网络和存储管理/pgsql" data-for="网络和存储管理/pgsql">pgsql</a></li><li><a href="../网络和存储管理/网络和存储管理" data-for="网络和存储管理/网络和存储管理">网络和存储管理</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="自动化和编程"><button class="folder-button"><span class="folder-title">自动化和编程</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="自动化和编程"><li><a href="../自动化和编程/ansible" data-for="自动化和编程/ansible">ansible</a></li><li><a href="../自动化和编程/git" data-for="自动化和编程/git">git</a></li><li><a href="../自动化和编程/github-actions" data-for="自动化和编程/github-actions">github actions</a></li><li><a href="../自动化和编程/Jinja2" data-for="自动化和编程/Jinja2">jinja2</a></li><li><a href="../自动化和编程/自动化和编程" data-for="自动化和编程/自动化和编程">自动化和编程</a></li></ul></div></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../自动化和编程/">自动化和编程</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>ansible</a></div></nav><h1 class="article-title">ansible</h1><p class="content-meta">2024年4月02日, 37分钟阅读</p><ul class="tags"><li><a href="../tags/自动化和编程" class="internal tag-link">#自动化和编程</a></li></ul></div></div><article class="popover-hint"><h2 id="简介">简介<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#简介" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>基于Python开源的自动化工具，用于配置管理、部署、编排和远程执行任务，它使用SSH协议进行通信，由Paramiko（Python库）、 PyYAML和Jinja2 ( 模板化 ) 三个关键模块实现，并使用基于YAML的描述文件来定义任务和配置</p>
<h2 id="特性">特性<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#特性" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li>模块化</li>
<li>无客户端</li>
<li>主从模式</li>
<li>幂等性</li>
</ul>
<h2 id="关键参数">关键参数<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#关键参数" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li>
<p>主机清单（Inventory）：主机清单是一个YAML或INI格式的文件，用于定义受管理的主机和主机组，它指定了Ansible将在哪些主机上执行任务</p>
</li>
<li>
<p>模块（Module）：模块是Ansible的基本执行单元，用于在目标主机上执行特定的任务，Ansible提供了丰富的模块库，包括文件操作、软件包管理、用户管理等各种功能</p>
</li>
<li>
<p>Playbook（剧本）：Playbook是一个YAML格式的文件，用于定义一系列任务和配置的顺序，它描述了Ansible在目标主机上执行的操作流程，包括主机选择、任务执行和变量设置等</p>
</li>
<li>
<p>角色（Role）：角色是一种组织和复用任务和配置的方法，它将相关的任务、变量和文件组织在一起，以便在多个Playbook中重复使用</p>
</li>
<li>
<p>变量（Variable）：变量用于存储和传递数据，在Playbook中可以使用变量来实现灵活的配置，变量可以在主机清单、Playbook和角色中定义，并可以通过模板或命令行参数进行动态设置</p>
</li>
<li>
<p>Handlers：Handlers是一种特殊的任务，它用于响应其他任务的状态变化，当某个任务发生变化时，Handlers可以触发相应的操作，如重新启动服务、重新加载配置等</p>
</li>
<li>
<p>模板（Template）：模板是一种用于生成配置文件的机制，Ansible使用<a href="../自动化和编程/jinja2" class="internal alias" data-slug="自动化和编程/jinja2">jinja2</a>模板引擎，可以在模板中使用变量和条件语句来动态生成配置文件</p>
</li>
<li>
<p>Vault：Vault用于安全地存储敏感信息，如密码和密钥，它可以加密和解密Ansible的变量文件，以防止敏感信息泄露</p>
</li>
</ol>
<h2 id="开始">开始<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#开始" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]# ansible localhost -m command -a </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">'echo hello world!'</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localhost</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CHANGED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> >></span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hello</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> world!</span></span></code></pre></figure>
<h2 id="ad-hoc-command">Ad-Hoc command<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ad-hoc-command" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>简短地指令，指令操作模式</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@localhost ansible]# ansible local -m ping</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10.191.101.254</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;ansible_facts&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        &quot;discovered_interpreter_python&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/usr/bin/python&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;changed&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;ping&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;pong&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></figure>
<p>Ad-Hoc commands 一次只能处理一件事情，这即是它与 Playbooks 最大的差异</p>
<h2 id="playbook">Playbook<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#playbook" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Ansible 剧本，可以通过事先写好的剧本 (Playbooks)来让各个被控节点进行指定的动作 (Plays) 和任务 (Tasks)</p>
<pre><code>[root@localhost ansible]# ansible-playbook playbooks/main.yml

PLAY [Test] *************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************
ok: [10.191.101.254]

TASK [Hello world] ******************************************************************************************************************************
changed: [10.191.101.254]

TASK [Print stdout] *****************************************************************************************************************************
ok: [10.191.101.254] => {
    &quot;msg&quot;: &quot;&quot;
}

PLAY RECAP **************************************************************************************************************************************
10.191.101.254             : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre>
<h2 id="playtask与module">Play、Task与Module<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#playtask与module" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li><strong>Play</strong>：通常为某个特定的目的，例如：
<ul>
<li><code>Setup a official website with Drupal</code> (借由 Drupal 建置官网)</li>
<li><code>Restart the API service</code> (重开 API 服务)</li>
</ul>
</li>
<li><strong>Task</strong>：是要实行 Play 这个目地所需做的每个步骤，例如：
<ul>
<li><code>Install the Nginx</code> (安裝 Nginx)</li>
<li><code>Kill the djnago process</code> (强制停止 django 的行程)</li>
</ul>
</li>
<li><strong>Module</strong>：Ansible 所提供的各种操作方法，例如：
<ul>
<li><code>apt: name=vim state=present</code> (使用 apt 套件安装 vim)</li>
<li><code>command: /sbin/shutdown -r now</code> (使用 shutdown 的指令重新开机)</li>
</ul>
</li>
</ul>
<h2 id="关键字">关键字<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#关键字" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li><code>name</code>：用于定义任务的名称，提供可读性和描述性的信息，</li>
<li><code>hosts</code>：指定要在哪些主机上执行任务，可以使用主机组、主机模式、主机列表或动态主机，</li>
<li><code>vars</code>：用于定义任务级别的变量，可以在任务中使用这些变量进行配置和操作，</li>
<li><code>vars_files</code>：指定一个或多个 YAML 文件，包含要加载的变量定义，</li>
<li><code>vars_prompt</code>：在运行任务之前，提示用户输入一个或多个变量的值，</li>
<li><code>gather_facts</code>：指定是否收集目标主机的事实（facts），如果设置为 <code>yes</code>，Ansible 会在执行任务之前通过执行模块收集主机的信息，</li>
<li><code>register</code>：将任务执行的结果保存到一个变量中，以便后续任务使用，</li>
<li><code>debug</code>：用于打印消息或变量的值，可以用于调试和输出信息，</li>
<li><code>include</code>：包含其他 Ansible 文件（如任务文件或变量文件），</li>
<li><code>with_items</code>：在循环中迭代一个列表，并为每个元素执行一个任务，</li>
<li><code>when</code>：定义一个条件，只有当条件满足时，才执行任务，可以使用 Ansible 的条件表达式进行逻辑判断，</li>
<li><code>failed</code>：检查前一任务是否失败，可以在后续任务中根据前一任务的状态执行不同的操作，</li>
<li><code>changed</code>：检查前一任务是否引起了主机的变化，可以在后续任务中根据主机的状态执行不同的操作，</li>
<li><code>notify</code>：在任务执行完成后触发一个处理程序（handler），用于执行特定的操作，</li>
</ol>
<h2 id="ansible-inventory">Ansible inventory<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ansible-inventory" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>用于动态生成Ansible inventory的命令行工具，Ansible inventory用于定义Ansible可以管理的主机和主机组，以及与这些主机相关的变量，通过使用<code>ansible-inventory</code>命令，可以根据不同的数据源生成动态的Ansible inventory</p>
<ol>
<li>查看当前主机和主机组</li>
</ol>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-inventory</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --list</span></span></code></pre></figure>
<ol start="2">
<li>使用静态文件生成inventory，使用静态的INI格式文件来定义主机和主机组</li>
</ol>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="ini" data-theme="github-light github-dark"><code data-language="ini" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[web_servers]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">web1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ansible_host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=192.168.1.10</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">web2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ansible_host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=192.168.1.11</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[db_servers]</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ansible_host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=192.168.1.20</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">db2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ansible_host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=192.168.1.21</span></span></code></pre></figure>
<ol start="3">
<li>使用动态脚本来生成更灵活的inventory，创建一个Python脚本，并实现必要的逻辑来动态生成inventory</li>
</ol>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-inventory</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dynamic_inventory.py --list</span></span></code></pre></figure>
<ol start="4">
<li>使用外部数据源生成inventory，<code>ansible-inventory</code>可以与外部数据源集成，如AWS EC2、OpenStack，使用相关插件来配置和指定数据源</li>
</ol>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-inventory</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ec2.yaml --list</span></span></code></pre></figure>
<h2 id="ansible-galaxy">Ansible Galaxy<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ansible-galaxy" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Ansible Galaxy是一个用于共享和管理Ansible角色的平台，当使用Ansible Galaxy创建或安装角色时，它会生成一种常见的目录结构，以便更好地组织和管理角色</p>
<p><strong>创建角色</strong>：使用<code>ansible-galaxy init</code>命令创建角色，并指定角色的名称，创建一个名为”my_role”的角色</p>
<pre><code>ansible-galaxy init my_role
</code></pre>
<h3 id="ansible-galaxy生成的典型目录结构">Ansible Galaxy生成的典型目录结构<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#ansible-galaxy生成的典型目录结构" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><code>role_name/
  ├── defaults/
  │   └── main.yml
  ├── files/
  │   └── some_file.txt
  ├── handlers/
  │   └── main.yml
  ├── meta/
  │   └── main.yml
  ├── tasks/
  │   └── main.yml
  ├── templates/
  │   └── some_template.j2
  ├── vars/
  │   └── main.yml
  └── README.md
</code></pre>
<ul>
<li><code>defaults/</code>：包含角色的默认变量，这些变量会被其他任务和角色使用</li>
<li><code>files/</code>：包含角色使用的静态文件，如配置文件或脚本</li>
<li><code>handlers/</code>：包含角色的处理程序，用于处理特定的事件或触发器</li>
<li><code>meta/</code>：包含角色的元数据，如作者、依赖项和支持的平台</li>
<li><code>tasks/</code>：包含角色的主要任务，即要执行的操作</li>
<li><code>templates/</code>：包含角色使用的模板文件，这些文件可以根据变量动态生成内容</li>
<li><code>vars/</code>：包含角色的变量文件，用于定义角色的变量值</li>
<li><code>README.md</code>：角色的说明和文档</li>
</ul>
<h3 id="使用ansible-galaxy的常见步骤">使用Ansible Galaxy的常见步骤<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#使用ansible-galaxy的常见步骤" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ol>
<li>搜索角色，使用<code>ansible-galaxy search</code>命令搜索Ansible Galaxy上的角色</li>
</ol>
<p>搜索名为”nginx”的角色</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-galaxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> search nginx</span></span></code></pre></figure>
<ol start="2">
<li>查看角色详情，使用<code>ansible-galaxy info</code>命令查看角色的详细信息</li>
</ol>
<p>查看名为”nginx”的角色的详细信息</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-galaxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info nginx</span></span></code></pre></figure>
<ol start="3">
<li>安装角色，使用<code>ansible-galaxy install</code>命令安装角色，可以通过指定角色名称和可选的版本号来安装角色</li>
</ol>
<p>安装名为”nginx”的最新版本角色</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-galaxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install nginx</span></span></code></pre></figure>
<p>安装特定版本的角色</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-galaxy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install nginx,1.0.0</span></span></code></pre></figure>
<ol start="4">
<li>使用角色，一旦安装了角色，可以使用<code>roles</code>关键字来指定要使用的角色</li>
</ol>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="yaml" data-theme="github-light github-dark"><code data-language="yaml" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">My Playbook</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  hosts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">all</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  roles</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span></code></pre></figure>
<ol start="5">
<li>管理角色，使用<code>ansible-galaxy</code>命令来管理已安装的角色</li>
</ol>
<ul>
<li><code>ansible-galaxy list</code>命令列出已安装的角色</li>
<li><code>ansible-galaxy remove</code>命令卸载角色</li>
<li><code>ansible-galaxy update</code>命令更新角色</li>
</ul>
<h2 id="常用的-ansible-module">常用的 Ansible Module<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#常用的-ansible-module" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="command">command<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#command" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><code>command</code>模块是个可以在远端上执行指令的指令模组（Commands Modules），但它不支持变数（变量）和  <code>&lt;</code> ，  <code>></code>，  <code>|</code>，  <code>;</code>  和  <code>&amp;</code> 等运算，若有这类请需求改用<code>shell</code>模块</p>
<ul>
<li>chdir：指定要在远程主机上执行命令的工作目录</li>
<li>creates：指定一个文件路径，如果该文件存在，则命令将不会执行</li>
<li>executable：指定要执行的命令的可执行文件路径，例如/bin/bash</li>
<li>removes：指定一个文件路径，如果该文件不存在，则命令将不会执行</li>
<li>warn：默认为yes，如果设置为no，则不会在命令失败时发出警告</li>
<li>stdin：将命令的标准输入设置为指定的字符串</li>
<li>stdin_add_newline：默认为yes，如果设置为no，则不会在stdin末尾添加换行符</li>
<li>strip_empty_ends：默认为yes，如果设置为no，则不会去掉命令输出中的空行</li>
<li>cmd：要在远程主机上执行的命令</li>
</ul>
<h3 id="shell">shell<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#shell" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>shell模块用于在远程主机上执行Shell命令</p>
<ul>
<li><code>chdir</code>：指定要在远程主机上执行命令的工作目录</li>
<li><code>creates</code>：指定一个文件路径，如果该文件存在，则命令将不会执行</li>
<li><code>executable</code>：指定要执行的命令的可执行文件路径，例如<code>/bin/bash</code></li>
<li><code>removes</code>：指定一个文件路径，如果该文件不存在，则命令将不会执行</li>
<li><code>warn</code>：默认为<code>yes</code>，如果设置为<code>no</code>，则不会在命令失败时发出警告</li>
<li><code>stdin</code>：将命令的标准输入设置为指定的字符串</li>
<li><code>stdin_add_newline</code>：默认为<code>yes</code>，如果设置为<code>no</code>，则不会在stdin末尾添加换行符</li>
<li><code>strip_empty_ends</code>：默认为<code>yes</code>，如果设置为<code>no</code>，则不会去掉命令输出中的空行</li>
<li><code>cmd</code>：要在远程主机上执行的Shell命令</li>
</ul>
<h3 id="stat">stat<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#stat" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><code>stat</code> 模块用于获取文件或路径的状态信息</p>
<h4 id="常用参数选项">常用参数选项<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#常用参数选项" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ul>
<li><code>path</code>（必需）：要检查状态的文件或路径</li>
<li><code>follow</code>：如果路径是符号链接，是否跟随链接获取链接指向的文件的状态，默认为 <code>no</code>，不跟随链接</li>
<li><code>get_checksum</code>：是否获取文件的校验和，默认为 <code>no</code></li>
<li><code>checksum_algorithm</code>：用于计算校验和的算法，仅当 <code>get_checksum</code> 为 <code>yes</code> 时有效，可选的值有 <code>md5</code>、<code>sha1</code>、<code>sha224</code>、<code>sha256</code>、<code>sha384</code> 和 <code>sha512</code>，默认为 <code>md5</code></li>
<li><code>get_md5</code>、<code>get_sha1</code>、<code>get_sha224</code>、<code>get_sha256</code>、<code>get_sha384</code>、<code>get_sha512</code>：分别指定是否获取特定类型的校验和，这些选项会覆盖 <code>get_checksum</code> 和 <code>checksum_algorithm</code></li>
<li><code>follow_ancestors</code>：如果路径不存在，是否跟随祖先路径，默认为 <code>no</code></li>
<li><code>file_type</code>：用于检查文件类型的选项，可选的值有 <code>file</code>、<code>directory</code>、<code>symlink</code>、<code>hard</code> 和 <code>socket</code>，可以指定多个类型，以逗号分隔</li>
<li><code>file_gid</code>、<code>file_group</code>：用于检查文件所属组的选项，可以指定组 ID 或组名</li>
<li><code>file_uid</code>、<code>file_owner</code>：用于检查文件所有者的选项，可以指定用户 ID 或用户名</li>
<li><code>path_stat</code>：指定一个变量名，将状态信息存储在该变量中，而不是默认的 <code>stat</code> 变量</li>
<li><code>follow_mode</code>：是否跟随路径获取模式，默认为 <code>yes</code></li>
</ul>
<h4 id="常用的文件状态属性">常用的文件状态属性<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#常用的文件状态属性" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h4>
<ul>
<li><code>exists</code>：文件是否存在，返回布尔值（<code>true</code> 或 <code>false</code>）</li>
<li><code>isdir</code>：文件是否是目录，返回布尔值</li>
<li><code>isfile</code>：文件是否是常规文件，返回布尔值</li>
<li><code>isreg</code>：文件是否是普通文件，返回布尔值</li>
<li><code>islink</code>：文件是否是符号链接，返回布尔值</li>
<li><code>uid</code>：文件的所有者用户 ID</li>
<li><code>gid</code>：文件的所有者组 ID</li>
<li><code>mode</code>：文件的权限模式，以八进制表示</li>
<li><code>size</code>：文件的大小（字节）</li>
<li><code>mtime</code>：文件的修改时间戳</li>
</ul>
<h3 id="file">file<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#file" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>file模块用于管理文件和目录的属性和权限</p>
<ul>
<li><code>path</code>：指定要管理的文件或目录的路径</li>
<li><code>state</code>：指定文件或目录的状态，可以是<code>file</code>、<code>directory</code>、<code>link</code>、<code>hard</code>、<code>touch</code>等</li>
<li><code>mode</code>：指定文件或目录的权限模式，例如<code>0644</code></li>
<li><code>owner</code>：指定文件或目录的所有者</li>
<li><code>group</code>：指定文件或目录的所属组</li>
<li><code>recurse</code>：如果设置为<code>yes</code>，则递归地应用文件或目录的属性和权限</li>
<li><code>follow</code>：如果设置为<code>yes</code>，则会跟随符号链接操作</li>
<li><code>force</code>：如果设置为<code>yes</code>，在修改文件或目录属性时会强制执行</li>
<li><code>selevel</code>：指定SELinux安全标签的级别</li>
<li><code>serole</code>：指定SELinux安全标签的角色</li>
<li><code>setype</code>：指定SELinux安全标签的类型</li>
<li><code>seuser</code>：指定SELinux安全标签的用户</li>
</ul>
<h3 id="copy">copy<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#copy" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>copy模块用于将文件或目录复制到远程主机</p>
<ul>
<li><code>src</code>：指定要复制的源文件或目录的路径</li>
<li><code>dest</code>：指定目标文件或目录的路径</li>
<li><code>backup</code>：如果设置为<code>yes</code>，在复制文件之前会创建备份文件</li>
<li><code>force</code>：如果设置为<code>yes</code>，则即使目标文件已存在，也会强制复制文件</li>
<li><code>mode</code>：指定目标文件的权限模式，例如<code>0644</code></li>
<li><code>owner</code>：指定目标文件的所有者</li>
<li><code>group</code>：指定目标文件的所属组</li>
<li><code>remote_src</code>：如果设置为<code>yes</code>，则将在远程主机上查找源文件</li>
<li><code>validate</code>：指定一个命令来验证复制的文件，如果验证命令不返回零，则会发出错误</li>
<li><code>follow</code>：如果设置为<code>yes</code>，则会跟随源文件的符号链接进行复制</li>
<li><code>content</code>：将指定的内容复制到目标文件</li>
</ul>
<h3 id="debug">debug<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#debug" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>debug模块用于输出调试信息</p>
<ul>
<li><code>msg</code>：指定要输出的调试信息</li>
<li><code>var</code>：指定要输出的变量的值</li>
<li><code>verbosity</code>：指定输出的详细程度，可以是<code>0</code>（只输出关键信息）、<code>1</code>（默认，输出一般信息）、<code>2</code>（输出详细信息）等</li>
<li><code>debugger_on</code>：如果设置为<code>yes</code>，则在输出调试信息后启用调试器</li>
</ul>
<h3 id="lineinfile">lineinfile<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#lineinfile" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>lineinfile模块用于在文件中搜索并替换行</p>
<ul>
<li><code>path</code>：指定要操作的文件的路径，</li>
<li><code>line</code>：指定要插入、修改或删除的行内容</li>
<li><code>state</code>：指定行的状态，可以是<code>present</code>（存在）、<code>absent</code>（不存在）、<code>before</code>（在指定行之前插入）、<code>after</code>（在指定行之后插入）等</li>
<li><code>regexp</code>：指定用于搜索行的正则表达式</li>
<li><code>backrefs</code>：如果设置为<code>yes</code>，则在替换行时可以在<code>line</code>中使用后向引用</li>
<li><code>insertafter</code>：指定在哪一行之后插入新行</li>
<li><code>insertbefore</code>：指定在哪一行之前插入新行</li>
<li><code>dest</code>：指定目标文件的路径，如果设置，则会将匹配的行复制到该文件中</li>
<li><code>firstmatch</code>：如果设置为<code>yes</code>，则只匹配第一条满足条件的行</li>
</ul>
<h3 id="service">service<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#service" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>service模块用于管理系统服务的状态</p>
<ul>
<li><code>name</code>：指定要管理的服务的名称</li>
<li><code>state</code>：指定服务的状态，可以是<code>started</code>（启动）、<code>stopped</code>（停止）、<code>restarted</code>（重新启动）、<code>reloaded</code>（重新加载）等</li>
<li><code>enabled</code>：如果设置为<code>yes</code>，则在系统启动时启用服务</li>
<li><code>disabled</code>：如果设置为<code>yes</code>，则在系统启动时禁用服务</li>
<li><code>pattern</code>：指定用于匹配服务进程的模式，可以是进程名称、进程ID等</li>
<li><code>arguments</code>：指定启动服务时要传递的附加参数</li>
<li><code>sleep</code>：指定在重新启动或重新加载服务之前等待的时间，以秒为单位</li>
<li><code>timeout</code>：指定等待服务状态变化的超时时间，以秒为单位</li>
<li><code>runlevel</code>：指定服务在哪个运行级别下启动</li>
</ul>
<h3 id="user">user<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#user" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>user模块用于管理系统用户，下面是一些常用的参数选项的介绍：</p>
<ul>
<li><code>name</code>：指定要管理的用户的用户名</li>
<li><code>state</code>：指定用户的状态，可以是<code>present</code>（存在）、<code>absent</code>（不存在）、<code>locked</code>（锁定）等</li>
<li><code>uid</code>：指定用户的用户ID</li>
<li><code>password</code>：指定用户的密码，可以是明文密码，也可以是加密后的密码</li>
<li><code>group</code>：指定用户所属的主组</li>
<li><code>groups</code>：指定用户所属的附加组</li>
<li><code>shell</code>：指定用户的默认shell</li>
<li><code>home</code>：指定用户的家目录路径</li>
<li><code>createhome</code>：如果设置为<code>yes</code>，则在创建用户时创建家目录</li>
<li><code>remove</code>：如果设置为<code>yes</code>，则在删除用户时同时删除家目录</li>
<li><code>move_home</code>：如果设置为<code>yes</code>，则在修改用户家目录路径时同时移动家目录</li>
<li><code>non_unique</code>：如果设置为<code>yes</code>，则允许非唯一的用户ID</li>
</ul>
<h3 id="lvm">lvm<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#lvm" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>lvm模块用于管理逻辑卷管理器（LVM）</p>
<ul>
<li><code>vg</code>：指定要管理的卷组的名称</li>
<li><code>pvs</code>：指定要创建物理卷的设备</li>
<li><code>lvs</code>：指定要创建逻辑卷的卷组和逻辑卷的配置</li>
<li><code>state</code>：指定卷组、物理卷或逻辑卷的状态，可以是<code>present</code>（存在）、<code>absent</code>（不存在）等</li>
<li><code>resizefs</code>：如果设置为<code>yes</code>，则在调整逻辑卷大小后同时调整文件系统大小</li>
<li><code>force</code>：如果设置为<code>yes</code>，则在删除逻辑卷或卷组时强制执行</li>
<li><code>zero</code>：如果设置为<code>yes</code>，则在删除物理卷时将其填充为零</li>
<li><code>pvresize</code>：如果设置为<code>yes</code>，则在创建或删除物理卷后调整物理卷的大小</li>
<li><code>fstype</code>：指定逻辑卷上的文件系统类型</li>
</ul>
<h3 id="mount">mount<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#mount" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Ansible的mount模块主要用于管理被控端设备的挂载，包括挂载和卸载操作。该模块的基本功能是配置文件系统的挂载点，以及与之相关的参数设置。</p>
<h3 id="常用参数选项介绍">常用参数选项介绍<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#常用参数选项介绍" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>mount模块主要用于管理被控端设备的挂载，包括挂载和卸载操作。该模块的基本功能是配置文件系统的挂载点，以及与之相关的参数设置。</p>
<ol>
<li><strong>state</strong>：指定挂载点的状态，可以是<code>present</code>（表示挂载点存在）或<code>mounted</code>（表示挂载点已挂载）。这是执行挂载操作时必须指定的参数之一。</li>
<li><strong>src</strong>：指定要挂载的设备或文件系统的路径。这个参数是必需的，用于明确挂载源的位置。</li>
<li><strong>path</strong>：指定设备挂载至本地的路径，即挂载点。这个参数也是必需的，用于定义挂载的目标位置。</li>
<li><strong>fstype</strong>：指定挂载的文件系统类型，如<code>ext4</code>、<code>nfs</code>等。当<code>state</code>为<code>present</code>或<code>mounted</code>时，此参数是必需的。</li>
<li><strong>opts</strong>：挂载选项，用于指定挂载时的具体参数，如权限、同步模式等。这些选项可以根据需要进行自定义。</li>
<li><strong>dest</strong>：虽然在一些文档中提到，但实际上在官方文档和示例中并未明确提及此参数。它可能是一个误导信息，或者是在特定上下文中使用的非标准参数。</li>
<li><strong>username</strong>和<strong>password</strong>：在某些情况下，如果挂载源是基于网络的共享（如NFS），可能需要提供用户名和密码来访问共享资源。这些参数用于指定访问共享时的身份验证信息。</li>
<li><strong>sync</strong>：指定将文件系统挂载为同步模式，确保数据立即写入磁盘，适用于需要高数据一致性的场景。</li>
</ol>
<h3 id="yum">yum<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#yum" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>yum模块用于管理CentOS或Red Hat系统上的软件包</p>
<ul>
<li><code>name</code>：指定要安装、卸载或更新的软件包的名称</li>
<li><code>state</code>：指定软件包的状态，可以是<code>present</code>（存在）、<code>absent</code>（不存在）、<code>latest</code>（最新）等</li>
<li><code>update_cache</code>：如果设置为<code>yes</code>，则在安装软件包之前会更新软件包缓存</li>
<li><code>disablerepo</code>：指定要禁用的软件源</li>
<li><code>enablerepo</code>：指定要启用的软件源</li>
<li><code>disable_gpg_check</code>：如果设置为<code>yes</code>，则会禁用软件包的GPG检查</li>
<li><code>installroot</code>：指定软件包的安装根目录</li>
<li><code>exclude</code>：指定要排除的软件包</li>
<li><code>skip_broken</code>：如果设置为<code>yes</code>，则会跳过损坏的软件包</li>
<li><code>disable_excludes</code>：如果设置为<code>yes</code>，则会禁用软件包的排除规则</li>
</ul>
<p>示例</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="yml" data-theme="github-light github-dark"><code data-language="yml" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">install httptd</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  yum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">name=httpd state=present</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">start httpd</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">name=httpd state=started</span></span></code></pre></figure>
<h3 id="pip">pip<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#pip" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>pip模块用于管理Python包</p>
<ul>
<li><code>name</code>：指定要安装、卸载或更新的Python包的名称</li>
<li><code>state</code>：指定Python包的状态，可以是<code>present</code>（存在）、<code>absent</code>（不存在）、<code>latest</code>（最新）等</li>
<li><code>executable</code>：指定要使用的pip可执行文件的路径</li>
<li><code>extra_args</code>：指定要传递给pip的额外参数</li>
<li><code>requirements</code>：指定一个要安装的包的要求文件路径</li>
<li><code>virtualenv</code>：指定一个虚拟环境的路径，安装包将被限制在该环境中</li>
<li><code>editable</code>：如果设置为<code>yes</code>，则使用可编辑模式安装包</li>
<li><code>chdir</code>：指定要切换到的目录，然后执行pip命令</li>
<li><code>umask</code>：指定安装包时的umask值</li>
<li><code>proxy</code>：指定代理服务器的URL</li>
</ul>
<h3 id="git">git<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#git" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>git模块用于管理Git仓库</p>
<ul>
<li><code>repo</code>：指定要克隆或更新的Git仓库的URL</li>
<li><code>dest</code>：指定要克隆或更新的目标目录的路径</li>
<li><code>version</code>：指定要检出的Git分支、标签或提交的版本号</li>
<li><code>accept_hostkey</code>：如果设置为<code>yes</code>，则接受远程主机的SSH密钥</li>
<li><code>force</code>：如果设置为<code>yes</code>，则强制执行克隆或更新操作</li>
<li><code>key_file</code>：指定用于身份验证的SSH私钥文件的路径</li>
<li><code>recursive</code>：如果设置为<code>yes</code>，则递归地克隆或更新Git子模块</li>
<li><code>clone</code>：如果设置为<code>yes</code>，则会执行克隆操作；如果设置为<code>no</code>，则只会执行更新操作</li>
<li><code>depth</code>：指定克隆仓库时的深度，即最近的提交数量</li>
<li><code>bare</code>：如果设置为<code>yes</code>，则克隆一个裸仓库</li>
</ul>
<h3 id="cron">cron<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#cron" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>cron模块用于管理定时任务（cron jobs）</p>
<ul>
<li><code>name</code>：指定要管理的定时任务的名称</li>
<li><code>user</code>：指定定时任务所属的用户</li>
<li><code>job</code>：指定定时任务的命令</li>
<li><code>state</code>：指定定时任务的状态，可以是<code>present</code>（存在）、<code>absent</code>（不存在）等</li>
<li><code>minute</code>：指定定时任务执行的分钟数</li>
<li><code>hour</code>：指定定时任务执行的小时数</li>
<li><code>day</code>：指定定时任务执行的日期</li>
<li><code>month</code>：指定定时任务执行的月份</li>
<li><code>weekday</code>：指定定时任务执行的星期几</li>
<li><code>reboot</code>：如果设置为<code>yes</code>，则定时任务将在系统重启后执行</li>
<li><code>special_time</code>：指定特殊的定时任务执行时间，如<code>@reboot</code>（系统重启后）、<code>@daily</code>（每天）、<code>@weekly</code>（每周）等</li>
<li><code>job_file</code>：指定定时任务的文件路径</li>
<li><code>backup</code>：如果设置为<code>yes</code>，则在修改定时任务时备份原始文件</li>
<li><code>state_file</code>：指定保存定时任务状态的文件路径</li>
</ul>
<h3 id="fetch">fetch<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#fetch" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>fetch模块用于从远程主机复制文件到控制节点</p>
<ul>
<li><code>src</code>：指定要复制的远程主机上的文件路径</li>
<li><code>dest</code>：指定目标文件或目录的路径</li>
<li><code>flat</code>：如果设置为<code>yes</code>，则在目标目录中只创建一个文件，而不是使用远程主机上的完整路径</li>
<li><code>validate_checksum</code>：如果设置为<code>yes</code>，则在复制文件之前检查文件的校验和</li>
<li><code>md5sum_file</code>：指定一个文件路径，用于存储远程主机上文件的校验和</li>
<li><code>backup</code>：如果设置为<code>yes</code>，在复制文件之前会创建备份文件</li>
<li><code>force</code>：如果设置为<code>yes</code>，则即使目标文件已存在，也会强制复制文件</li>
</ul>
<h3 id="template">template<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#template" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>template模块用于根据模板文件生成配置文件</p>
<ul>
<li><code>src</code>：指定模板文件的路径</li>
<li><code>dest</code>：指定生成的配置文件的路径</li>
<li><code>owner</code>：指定生成的配置文件的所有者</li>
<li><code>group</code>：指定生成的配置文件的所属组</li>
<li><code>mode</code>：指定生成的配置文件的权限模式</li>
<li><code>backup</code>：如果设置为<code>yes</code>，则在生成配置文件之前备份原始文件</li>
<li><code>validate</code>：指定一个自定义的命令或脚本来验证生成的配置文件</li>
<li><code>force</code>：如果设置为<code>yes</code>，则强制生成配置文件，即使目标文件已经存在</li>
<li><code>become</code>：如果设置为<code>yes</code>，则以超级用户身份生成配置文件</li>
<li><code>vars</code>：指定要传递给模板文件的变量</li>
<li><code>unsafe_writes</code>：如果设置为<code>yes</code>，则使用不安全的写入方式生成配置文件</li>
</ul>
<h3 id="docker_">docker_*<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#docker_" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>docker_*模块用于管理Docker容器和镜像</p>
<ol>
<li>
<p>docker_container模块</p>
<ul>
<li><code>name</code>：指定要操作的容器的名称</li>
<li><code>image</code>：指定要使用的镜像</li>
<li><code>state</code>：指定容器的状态，可以是<code>started</code>（启动）、<code>stopped</code>（停止）、<code>restarted</code>（重启）、<code>absent</code>（删除）等</li>
<li><code>restart_policy</code>：指定容器的重启策略</li>
<li><code>ports</code>：指定容器的端口映射</li>
<li><code>volumes</code>：指定容器的卷挂载</li>
<li><code>env</code>：指定容器的环境变量</li>
<li><code>command</code>：指定容器的启动命令</li>
</ul>
</li>
<li>
<p>docker_image模块</p>
<ul>
<li><code>name</code>：指定要操作的镜像的名称</li>
<li><code>source</code>：指定要使用的镜像源</li>
<li><code>state</code>：指定镜像的状态，可以是<code>present</code>（存在）、<code>absent</code>（不存在）等</li>
<li><code>pull</code>：如果设置为<code>yes</code>，则会拉取最新的镜像</li>
<li><code>force</code>：如果设置为<code>yes</code>，则会强制拉取镜像，即使已经存在</li>
</ul>
</li>
<li>
<p>docker_login模块</p>
<ul>
<li><code>registry_url</code>：指定要登录的Docker注册表的URL</li>
<li><code>username</code>：指定登录的用户名</li>
<li><code>password</code>：指定登录的密码</li>
<li><code>email</code>：指定登录的电子邮件地址</li>
</ul>
</li>
</ol>
<h2 id="常用的-ansible-规范">常用的 Ansible 规范<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#常用的-ansible-规范" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="changed_when">changed_when<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#changed_when" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p><code>changed_when</code>参数用于指定在哪些情况下标记任务为”changed”（已更改）。默认情况下，如果任何模块的返回结果中存在变化，则任务将被标记为”changed”。</p>
<p>为保证ansible代码的规范，在任务中需要明确是否返回对结果或条件的更改。除非任务只读取信息，否则应确保它们以以下方式返回更改：</p>
<ol>
<li>注册结果或条件并使用changed_when子句。</li>
<li>使用creates或removes参数。</li>
</ol>
<p><code>changed_when</code>参数可以使用以下方式指定：</p>
<ol>
<li>布尔值：当指定为<code>True</code>时，任务总是被标记为”changed”；当指定为<code>False</code>时，任务总是被标记为”ok”。</li>
<li>字符串：任务的输出将与指定的字符串进行比较。如果匹配，则任务被标记为”ok”；如果不匹配，则任务被标记为”changed”。可以使用Jinja2模板语法来引用变量。</li>
<li>Python表达式：可以使用Python表达式来指定任务的返回结果是否应被标记为”changed”。可以使用Jinja2模板语法来引用变量。</li>
</ol>
<p>示例：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="yml" data-theme="github-light github-dark"><code data-language="yml" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Check if file exists</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/path/to/file</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">file_stat</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Create file if it doesn't exist</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/path/to/source</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    dest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/path/to/file</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  changed_when</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;'file_stat.stat.exists' == 'False'&quot;</span></span></code></pre></figure>
<p>首先使用<code>stat</code>模块检查文件是否存在，并将结果存储在<code>file_stat</code>变量中。然后，使用<code>copy</code>模块复制文件。如果文件不存在（即<code>file_stat.stat.exists</code>为<code>False</code>），则任务被标记为”changed”，否则被标记为”ok”。</p>
<h3 id="register">register<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#register" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Ansible中的<code>register</code>关键字用于捕获任务（task）的输出，并将其保存到一个变量中，这样可以在后续的任务中调用这个变量。这种机制允许用户在执行特定操作后，根据操作的结果来决定如何响应，例如执行其他Ansible语句或进行条件判断等。通过使用<code>register</code>，可以将命令、模块或任务的输出存储到变量中，这不仅限于单个playbook内的使用，而且在不同的playbook之间也可以共享这些变量。例如，我们使用<code>register</code>将<code>stat</code>模块的结果保存到<code>file_stat</code>变量中：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="yml" data-theme="github-light github-dark"><code data-language="yml" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Check if file exists</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  stat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/path/to/file</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">file_stat</span></span></code></pre></figure>
<p>这将执行<code>stat</code>模块来检查文件是否存在，并将结果保存到<code>file_stat</code>变量中。然后，可以在后续任务中引用<code>file_stat</code>变量来获取之前任务的结果。在<code>copy</code>任务中使用了<code>file_stat</code>变量，以便根据文件是否存在来决定是否标记任务为”changed”：</p>
<pre><code>- name: Create file if it doesn't exist
  copy:
    src: /path/to/source
    dest: /path/to/file
  changed_when: &quot;'file_stat.stat.exists' == 'False'&quot;
</code></pre>
<p>使用了<code>file_stat.stat.exists</code>来访问之前<code>stat</code>模块的结果中的文件存在信息。如果文件不存在，则任务被标记为”changed”。</p>
<h3 id="fqcn">fqcn<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#fqcn" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>在Ansible中，Fully Qualified Collection Name（FQCN）是一种用于指定模块、插件或动作的完整集合名称的方法。这种做法有助于避免命名冲突和提高代码的可读性。从Ansible 2.10版本开始，许多插件和模块已经迁移到了Collections上，这意味着它们现在属于特定的命名空间，如<code>ansible.builtin </code>或自定义命名空间。使用FQCN可以确保操作使用的是正确的命名空间中的代码，从而避免了潜在的歧义和冲突。</p>
<p>例如，如果你想要使用<code>shell</code>模块，而不是简单地写<code>shell</code>，你应该使用其FQCN <code>ansible.builtin.shell</code>。同样，当引用一个集合的内容时，也可以通过FQCN来指定，如<code>my_namespace.my _collection.my _module</code>。此外，即使是在ansible-core中，也推荐使用FQCN来明确指出要使用的模块或插件，以避免与其他可能存在的集合发生冲突，并便于链接到模块文档。</p>
<p>在迁移Ansible playbook和角色时，强烈建议使用FQCN以避免意外行为。这是因为FQCN提供了一种更清晰的方式来指定使用的模块或插件的确切来源，尤其是在存在多个集合包含相同名称的模块或插件时。此外，使用FQCN还有助于保持Ansible内容的质量，通过遵循最佳实践，可以预防潜在的问题并维护一致且高效的自动化脚本。</p>
<p>FQCN是Ansible中一个重要的概念，它通过提供一个明确的命名空间来帮助开发者避免命名冲突，提高代码的可维护性和可读性。在编写Ansible剧本时，应当尽可能地使用FQCN来指定所需的模块、插件或动作。</p>
<p>示例：</p>
<figure data-rehype-pretty-code-figure><pre style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="yml" data-theme="github-light github-dark"><code data-language="yml" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Hello world</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      ansible.builtin.command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        cmd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">echo 'hello world'</span></span>
<span data-line><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      changed_when</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span></code></pre></figure></article></div><div class="right sidebar"><div class="graph"><h3>关系图谱</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc" class><h3>目录</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a href="#简介" data-for="简介">简介</a></li><li class="depth-0"><a href="#特性" data-for="特性">特性</a></li><li class="depth-0"><a href="#关键参数" data-for="关键参数">关键参数</a></li><li class="depth-0"><a href="#开始" data-for="开始">开始</a></li><li class="depth-0"><a href="#ad-hoc-command" data-for="ad-hoc-command">Ad-Hoc command</a></li><li class="depth-0"><a href="#playbook" data-for="playbook">Playbook</a></li><li class="depth-0"><a href="#playtask与module" data-for="playtask与module">Play、Task与Module</a></li><li class="depth-0"><a href="#关键字" data-for="关键字">关键字</a></li><li class="depth-0"><a href="#ansible-inventory" data-for="ansible-inventory">Ansible inventory</a></li><li class="depth-0"><a href="#ansible-galaxy" data-for="ansible-galaxy">Ansible Galaxy</a></li><li class="depth-1"><a href="#ansible-galaxy生成的典型目录结构" data-for="ansible-galaxy生成的典型目录结构">Ansible Galaxy生成的典型目录结构</a></li><li class="depth-1"><a href="#使用ansible-galaxy的常见步骤" data-for="使用ansible-galaxy的常见步骤">使用Ansible Galaxy的常见步骤</a></li><li class="depth-0"><a href="#常用的-ansible-module" data-for="常用的-ansible-module">常用的 Ansible Module</a></li><li class="depth-1"><a href="#command" data-for="command">command</a></li><li class="depth-1"><a href="#shell" data-for="shell">shell</a></li><li class="depth-1"><a href="#stat" data-for="stat">stat</a></li><li class="depth-1"><a href="#file" data-for="file">file</a></li><li class="depth-1"><a href="#copy" data-for="copy">copy</a></li><li class="depth-1"><a href="#debug" data-for="debug">debug</a></li><li class="depth-1"><a href="#lineinfile" data-for="lineinfile">lineinfile</a></li><li class="depth-1"><a href="#service" data-for="service">service</a></li><li class="depth-1"><a href="#user" data-for="user">user</a></li><li class="depth-1"><a href="#lvm" data-for="lvm">lvm</a></li><li class="depth-1"><a href="#mount" data-for="mount">mount</a></li><li class="depth-1"><a href="#常用参数选项介绍" data-for="常用参数选项介绍">常用参数选项介绍</a></li><li class="depth-1"><a href="#yum" data-for="yum">yum</a></li><li class="depth-1"><a href="#pip" data-for="pip">pip</a></li><li class="depth-1"><a href="#git" data-for="git">git</a></li><li class="depth-1"><a href="#cron" data-for="cron">cron</a></li><li class="depth-1"><a href="#fetch" data-for="fetch">fetch</a></li><li class="depth-1"><a href="#template" data-for="template">template</a></li><li class="depth-1"><a href="#docker_" data-for="docker_">docker_*</a></li><li class="depth-0"><a href="#常用的-ansible-规范" data-for="常用的-ansible-规范">常用的 Ansible 规范</a></li><li class="depth-1"><a href="#changed_when" data-for="changed_when">changed_when</a></li><li class="depth-1"><a href="#register" data-for="register">register</a></li><li class="depth-1"><a href="#fqcn" data-for="fqcn">fqcn</a></li></ul></div></div><div class="backlinks"><h3>反向链接</h3><ul class="overflow"><li>无法找到反向链接</li></ul></div></div></div><footer class><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.2.2</a> © 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></body><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="../postscript.js" type="module"></script></html>